
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="ie=edge" http-equiv="x-ua-compatible"/>
<meta content="Everything you need to know about (open) AEAs." name="description"/>
<link href="https://valory-xyz.github.io/open-aea/acn-internals/" rel="canonical"/>
<meta content="developer@fetch.ai,info@valory.xyz" name="author"/>
<meta content="Copy to clipboard" name="lang:clipboard.copy"/>
<meta content="Copied to clipboard" name="lang:clipboard.copied"/>
<meta content="en" name="lang:search.language"/>
<meta content="True" name="lang:search.pipeline.stopwords"/>
<meta content="True" name="lang:search.pipeline.trimmer"/>
<meta content="No matching documents" name="lang:search.result.none"/>
<meta content="1 matching document" name="lang:search.result.one"/>
<meta content="# matching documents" name="lang:search.result.other"/>
<meta content="[\s\-]+" name="lang:search.tokenizer"/>
<link href="../assets/images/favicon.png" rel="shortcut icon"/>
<meta content="mkdocs-1.1, mkdocs-material-4.6.3" name="generator"/>
<title>ACN Internals - open-aea</title>
<link href="../assets/stylesheets/application.adb8469c.css" rel="stylesheet"/>
<script src="../assets/javascripts/modernizr.86422ebf.js"></script>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
<link href="../assets/fonts/material-icons.css" rel="stylesheet"/>
<link href="../stylesheets/extra.css" rel="stylesheet"/>
</head>
<body dir="ltr">
<svg class="md-svg">
<defs>
<svg height="448" id="__github" viewbox="0 0 416 448" width="416" xmlns="http://www.w3.org/2000/svg"><path d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z" fill="currentColor"></path></svg>
</defs>
</svg>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<a class="md-skip" href="#messages-and-data-structures" tabindex="0">
        Skip to content
      </a>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a aria-label="open-aea" class="md-header-nav__button md-logo" href="https://valory-xyz.github.io/open-aea/" title="open-aea">
<i class="md-icon">code</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
              open-aea
            </span>
<span class="md-header-nav__topic">
              
                ACN Internals
              
            </span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a class="md-source" data-md-source="github" href="https://github.com/valory-xyz/open-aea/" title="Go to repository">
<div class="md-source__icon">
<svg height="24" viewbox="0 0 24 24" width="24">
<use height="24" width="24" xlink:href="#__github"></use>
</svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container">
<nav class="md-tabs md-tabs--active" data-md-component="tabs">
<div class="md-tabs__inner md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="..">
        Introduction
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../agent-oriented-development/">
          Concepts
        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../demos/">
          Demos
        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../quickstart/">
          Development - Beginner
        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../step-one/">
          Development - Intermediate
        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../generic-storage/">
          Development - Advanced
        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" role="main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title md-nav__title--site" for="__drawer">
<a class="md-nav__button md-logo" href="https://valory-xyz.github.io/open-aea/" title="open-aea">
<i class="md-icon">code</i>
</a>
    open-aea
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-source="github" href="https://github.com/valory-xyz/open-aea/" title="Go to repository">
<div class="md-source__icon">
<svg height="24" viewbox="0 0 24 24" width="24">
<use height="24" width="24" xlink:href="#__github"></use>
</svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href=".." title="Introduction">
      Introduction
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../version/" title="Version">
      Version
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../upgrading/" title="Upgrading">
      Upgrading
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" id="nav-4" type="checkbox"/>
<label class="md-nav__link" for="nav-4">
      Concepts
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="1">
<label class="md-nav__title" for="nav-4">
        Concepts
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../agent-oriented-development/" title="Agent-oriented development">
      Agent-oriented development
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../vision/" title="Vision">
      Vision
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../app-areas/" title="Application areas">
      Application areas
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../identity/" title="Identity">
      Identity
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../trust/" title="Trust minimisation">
      Trust minimisation
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../language-agnostic-definition/" title="Language Agnostic Definition">
      Language Agnostic Definition
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../registry/" title="Agent &amp; component registry">
      Agent &amp; component registry
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" id="nav-5" type="checkbox"/>
<label class="md-nav__link" for="nav-5">
      Demos
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="1">
<label class="md-nav__title" for="nav-5">
        Demos
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../demos/" title="Demos">
      Demos
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../echo_demo/" title="Echo Demo">
      Echo Demo
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../gym-example/" title="Gym example">
      Gym example
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../gym-skill/" title="Gym skill">
      Gym skill
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" id="nav-6" type="checkbox"/>
<label class="md-nav__link" for="nav-6">
      Development - Beginner
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="1">
<label class="md-nav__title" for="nav-6">
        Development - Beginner
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../quickstart/" title="AEA quick start">
      AEA quick start
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../core-components-1/" title="Core components - Part 1">
      Core components - Part 1
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../aea-vs-mvc/" title="AEA and web frameworks">
      AEA and web frameworks
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../core-components-2/" title="Core components - Part 2">
      Core components - Part 2
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../interaction-protocol/" title="How AEAs talk to each other - interaction protocols">
      How AEAs talk to each other - interaction protocols
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development-setup/" title="Development setup">
      Development setup
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/" title="Logging">
      Logging
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../debug/" title="Debugging">
      Debugging
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" id="nav-7" type="checkbox"/>
<label class="md-nav__link" for="nav-7">
      Development - Intermediate
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="1">
<label class="md-nav__title" for="nav-7">
        Development - Intermediate
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-1" id="nav-7-1" type="checkbox"/>
<label class="md-nav__link" for="nav-7-1">
      Developing New Components
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="2">
<label class="md-nav__title" for="nav-7-1">
        Developing New Components
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../step-one/" title="Ways to build an AEA">
      Ways to build an AEA
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../build-aea-step-by-step/" title="Build an AEA with the CLI">
      Build an AEA with the CLI
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../scaffolding/" title="Scaffolding packages">
      Scaffolding packages
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../protocol-generator/" title="Generating protocols">
      Generating protocols
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2" id="nav-7-2" type="checkbox"/>
<label class="md-nav__link" for="nav-7-2">
      Architecture &amp; component deep-dives
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="2">
<label class="md-nav__title" for="nav-7-2">
        Architecture &amp; component deep-dives
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../design-principles/" title="Design principles">
      Design principles
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../diagram/" title="Architectural diagram">
      Architectural diagram
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../connection/" title="Connections">
      Connections
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../protocol/" title="Protocols">
      Protocols
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../skill/" title="Skills">
      Skills
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../contract/" title="Contracts">
      Contracts
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../decision-maker/" title="Decision Maker">
      Decision Maker
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ledger-integration/" title="Ledger &amp; Crypto APIs">
      Ledger &amp; Crypto APIs
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../message-routing/" title="Message routing">
      Message routing
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../config/" title="Configurations">
      Configurations
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../limits/" title="Limitations of v1">
      Limitations of v1
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-3" id="nav-7-3" type="checkbox"/>
<label class="md-nav__link" for="nav-7-3">
      Use Case
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="2">
<label class="md-nav__title" for="nav-7-3">
        Use Case
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../connect-a-frontend/" title="Front-end intergration">
      Front-end intergration
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../http-connection-and-skill/" title="HTTP Connection">
      HTTP Connection
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../raspberry-set-up/" title="Build an AEA on a Raspberry Pi">
      Build an AEA on a Raspberry Pi
    </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-toggle md-nav__toggle" data-md-toggle="nav-8" id="nav-8" type="checkbox"/>
<label class="md-nav__link" for="nav-8">
      Development - Advanced
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="1">
<label class="md-nav__title" for="nav-8">
        Development - Advanced
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-1" id="nav-8-1" type="checkbox"/>
<label class="md-nav__link" for="nav-8-1">
      Topic Guides
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="2">
<label class="md-nav__title" for="nav-8-1">
        Topic Guides
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../generic-storage/" title="Generic Storage">
      Generic Storage
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../multi-agent-manager/" title="Multi agent manager">
      Multi agent manager
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../multiplexer-standalone/" title="Use multiplexer stand-alone">
      Use multiplexer stand-alone
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../standalone-transaction/" title="Create stand-alone transaction">
      Create stand-alone transaction
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../decision-maker-transaction/" title="Create decision-maker transaction">
      Create decision-maker transaction
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../skill-testing/" title="Testing Skills">
      Testing Skills
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../deployment/" title="Deployment">
      Deployment
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../12-factor/" title="12-Factor app and AEAs">
      12-Factor app and AEAs
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../known-limits/" title="Known limitations">
      Known limitations
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../build-aea-programmatically/" title="Build an AEA programmatically">
      Build an AEA programmatically
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../agent-vs-aea/" title="AEAs vs agents">
      AEAs vs agents
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../modes/" title="Modes of running an AEA">
      Modes of running an AEA
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../runtime-cost/" title="Profiling">
      Profiling
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../por/" title="Proof of Representation">
      Proof of Representation
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../security/" title="Security">
      Security
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-toggle md-nav__toggle" data-md-toggle="nav-8-2" id="nav-8-2" type="checkbox"/>
<label class="md-nav__link" for="nav-8-2">
      Agent Communication
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="2">
<label class="md-nav__title" for="nav-8-2">
        Agent Communication
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../acn/" title="Agent Communication Network">
      Agent Communication Network
    </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-toggle md-nav__toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
        ACN Internals
      </label>
<a class="md-nav__link md-nav__link--active" href="./" title="ACN Internals">
      ACN Internals
    </a>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#messages-and-data-structures">
    Messages and Data Structures
  </a>
<nav class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#agent-record">
    Agent Record
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-message">
    ACN Message
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#status">
    Status
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#register">
    Register
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lookuprequest">
    LookupRequest
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lookupresponse">
    LookupResponse
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#aeaenvelope">
    AeaEnvelope
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-protocol-interactions">
    ACN Protocol Interactions
  </a>
<nav class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#registration-interaction">
    "Registration" Interaction
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#look-up-interaction">
    "Look-up" Interaction
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#routing-interaction">
    "Routing" Interaction
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#joining-the-acn-network">
    Joining the ACN network
  </a>
<nav class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#relay-connections">
    Relay connections
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#delegate-connections">
    Delegate connections
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-transport">
    ACN transport
  </a>
<nav class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-envelope-entrance-agent-peer">
    ACN Envelope Entrance: Agent -&gt; Peer
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-envelope-routing">
    ACN Envelope Routing
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-envelope-exit-peer-agent">
    ACN Envelope Exit: Peer -&gt; Agent
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#connect-your-aea-to-the-acn">
    Connect your AEA to the ACN
  </a>
<nav class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#the-fetchaip2p_libp2p-connection">
    The fetchai/p2p_libp2p connection
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-fetchaip2p_libp2p_delegate-connection">
    The fetchai/p2p_libp2p_delegate connection
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#known-issues-and-limitations">
    Known issues and limitations
  </a>
<nav class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#delegate-client-on-client-disconnectionreconnection">
    Delegate client on client disconnection/reconnection
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#golang-node-python-client-libp2p-connection">
    Golang Node &lt;&gt; Python Client libp2p connection
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#what-a-peer-should-do-if-it-receives-an-acknowledgement-with-an-error">
    What a peer should do if it receives an acknowledgement with an error?
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#no-possibility-of-switching-peers">
    No possibility of switching peers
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-3" id="nav-8-3" type="checkbox"/>
<label class="md-nav__link" for="nav-8-3">
      Search &amp; Discovery
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="2">
<label class="md-nav__title" for="nav-8-3">
        Search &amp; Discovery
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../simple-oef/" title="Simple OEF">
      Simple OEF
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../defining-data-models/" title="Defining Data Models">
      Defining Data Models
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../query-language/" title="The Query Language">
      The Query Language
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../simple-oef-usage/" title="SOEF Connection">
      SOEF Connection
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-4" id="nav-8-4" type="checkbox"/>
<label class="md-nav__link" for="nav-8-4">
      Developer Interfaces
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="2">
<label class="md-nav__title" for="nav-8-4">
        Developer Interfaces
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-4-1" id="nav-8-4-1" type="checkbox"/>
<label class="md-nav__link" for="nav-8-4-1">
      CLI
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="3">
<label class="md-nav__title" for="nav-8-4-1">
        CLI
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../cli-how-to/" title="Installation">
      Installation
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../cli-commands/" title="Commands">
      Commands
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../package-imports/" title="File structure">
      File structure
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../wealth/" title="Generating wealth">
      Generating wealth
    </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-5" id="nav-8-5" type="checkbox"/>
<label class="md-nav__link" for="nav-8-5">
      Benchmarks
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="2">
<label class="md-nav__title" for="nav-8-5">
        Benchmarks
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../performance-benchmark/" title="Performance benchmark">
      Performance benchmark
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6" id="nav-8-6" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6">
      API
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="2">
<label class="md-nav__title" for="nav-8-6">
        API
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/abstract_agent/" title="AbstractAgent">
      AbstractAgent
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/aea/" title="AEA">
      AEA
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/aea_builder/" title="AEA Builder">
      AEA Builder
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/agent/" title="Agent">
      Agent
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/agent_loop/" title="Agent Loop">
      Agent Loop
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/common/" title="Common">
      Common
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/exceptions/" title="Exceptions">
      Exceptions
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/launcher/" title="Launcher">
      Launcher
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/multiplexer/" title="Multiplexer">
      Multiplexer
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/runner/" title="Runner">
      Runner
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/runtime/" title="Runtime">
      Runtime
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-12" id="nav-8-6-12" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-12">
      Components
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="3">
<label class="md-nav__title" for="nav-8-6-12">
        Components
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/components/base/" title="Base">
      Base
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/components/loader/" title="Loader">
      Loader
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/components/utils/" title="Utils">
      Utils
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-13" id="nav-8-6-13" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-13">
      Configurations
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="3">
<label class="md-nav__title" for="nav-8-6-13">
        Configurations
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/configurations/base/" title="Base">
      Base
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/configurations/constants/" title="Constants">
      Constants
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/configurations/data_types/" title="Data Types">
      Data Types
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/configurations/loader/" title="Loader">
      Loader
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/configurations/manager/" title="Manager">
      Manager
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/configurations/pypi/" title="Pypi">
      Pypi
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/configurations/utils/" title="Utils">
      Utils
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/configurations/validation/" title="Validation">
      Validation
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-14" id="nav-8-6-14" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-14">
      Connections
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="3">
<label class="md-nav__title" for="nav-8-6-14">
        Connections
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/connections/base/" title="Base">
      Base
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/context/base/" title="Context">
      Context
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-16" id="nav-8-6-16" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-16">
      Contracts
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="3">
<label class="md-nav__title" for="nav-8-6-16">
        Contracts
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/contracts/base/" title="Base">
      Base
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-17" id="nav-8-6-17" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-17">
      Crypto
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="3">
<label class="md-nav__title" for="nav-8-6-17">
        Crypto
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/crypto/base/" title="Base">
      Base
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/crypto/helpers/" title="Helpers">
      Helpers
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/crypto/ledger_apis/" title="LedgerApis">
      LedgerApis
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/crypto/plugin/" title="Plugin">
      Plugin
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/crypto/wallet/" title="Wallet">
      Wallet
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-17-6" id="nav-8-6-17-6" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-17-6">
      Registries
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="4">
<label class="md-nav__title" for="nav-8-6-17-6">
        Registries
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/crypto/registries/base/" title="Base">
      Base
    </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-18" id="nav-8-6-18" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-18">
      Decision Maker
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="3">
<label class="md-nav__title" for="nav-8-6-18">
        Decision Maker
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/decision_maker/base/" title="Base">
      Base
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/decision_maker/default/" title="Default">
      Default
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-19" id="nav-8-6-19" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-19">
      Error Handler
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="3">
<label class="md-nav__title" for="nav-8-6-19">
        Error Handler
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/error_handler/base/" title="Base">
      Base
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/error_handler/default/" title="Default">
      Default
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-20" id="nav-8-6-20" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-20">
      Helpers
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="3">
<label class="md-nav__title" for="nav-8-6-20">
        Helpers
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-20-1" id="nav-8-6-20-1" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-20-1">
      ACN
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="4">
<label class="md-nav__title" for="nav-8-6-20-1">
        ACN
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/acn/agent_record/" title="Agent Record">
      Agent Record
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/acn/uri/" title="URI">
      URI
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/async_friendly_queue/" title="Async Friendly Queue">
      Async Friendly Queue
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/async_utils/" title="Async Utils">
      Async Utils
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/base/" title="Base">
      Base
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/constants/" title="Constants">
      Constants
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/env_vars/" title="Env Vars">
      Env Vars
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/exception_policy/" title="Exception Policy">
      Exception Policy
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/exec_timeout/" title="Exec Timeout">
      Exec Timeout
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/file_io/" title="File IO">
      File IO
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/file_lock/" title="File Lock">
      File Lock
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/http_requests/" title="HttpRequests">
      HttpRequests
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/install_dependency/" title="Install Dependency">
      Install Dependency
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/io/" title="IO">
      IO
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-20-14" id="nav-8-6-20-14" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-20-14">
      IPFS
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="4">
<label class="md-nav__title" for="nav-8-6-20-14">
        IPFS
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/ipfs/base/" title="Base">
      Base
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/ipfs/utils/" title="Utils">
      Utils
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/logging/" title="Logging">
      Logging
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-20-16" id="nav-8-6-20-16" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-20-16">
      MultiAddress
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="4">
<label class="md-nav__title" for="nav-8-6-20-16">
        MultiAddress
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/multiaddr/base/" title="Base">
      Base
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/multiple_executor/" title="MultipleExecutor">
      MultipleExecutor
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/pipe/" title="Pipe">
      Pipe
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-20-19" id="nav-8-6-20-19" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-20-19">
      Preferences
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="4">
<label class="md-nav__title" for="nav-8-6-20-19">
        Preferences
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/preference_representations/base/" title="Base">
      Base
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/profiling/" title="Profiling">
      Profiling
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-20-21" id="nav-8-6-20-21" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-20-21">
      Search
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="4">
<label class="md-nav__title" for="nav-8-6-20-21">
        Search
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/search/generic/" title="Generic">
      Generic
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/search/models/" title="Models">
      Models
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/serializers/" title="Serializers">
      Serializers
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-20-23" id="nav-8-6-20-23" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-20-23">
      Storage
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="4">
<label class="md-nav__title" for="nav-8-6-20-23">
        Storage
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/storage/generic_storage/" title="GenericStorage">
      GenericStorage
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-20-23-2" id="nav-8-6-20-23-2" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-20-23-2">
      Backends
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="5">
<label class="md-nav__title" for="nav-8-6-20-23-2">
        Backends
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/storage/backends/base/" title="Base">
      Base
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/storage/backends/sqlite/" title="Sqlite">
      Sqlite
    </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/sym_link/" title="Sym Link">
      Sym Link
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-20-25" id="nav-8-6-20-25" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-20-25">
      Transaction
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="4">
<label class="md-nav__title" for="nav-8-6-20-25">
        Transaction
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/transaction/base/" title="Base">
      Base
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/win32/" title="Win32">
      Win32
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/yaml_utils/" title="YamlUtils">
      YamlUtils
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/identity/base/" title="Identity">
      Identity
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/mail/base/" title="Mail">
      Mail
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-23" id="nav-8-6-23" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-23">
      Manager
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="3">
<label class="md-nav__title" for="nav-8-6-23">
        Manager
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/manager/manager/" title="Manager">
      Manager
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/manager/project/" title="Project">
      Project
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/manager/utils/" title="Utils">
      Utils
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-24" id="nav-8-6-24" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-24">
      Protocols
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="3">
<label class="md-nav__title" for="nav-8-6-24">
        Protocols
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/protocols/base/" title="Base">
      Base
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-24-2" id="nav-8-6-24-2" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-24-2">
      Dialogue
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="4">
<label class="md-nav__title" for="nav-8-6-24-2">
        Dialogue
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/protocols/dialogue/base/" title="Base">
      Base
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-24-3" id="nav-8-6-24-3" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-24-3">
      Generator
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="4">
<label class="md-nav__title" for="nav-8-6-24-3">
        Generator
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/protocols/generator/base/" title="Base">
      Base
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/protocols/generator/common/" title="Common">
      Common
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/protocols/generator/extract_specification/" title="Extract Specification">
      Extract Specification
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/protocols/generator/validate/" title="Validate">
      Validate
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-24-4" id="nav-8-6-24-4" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-24-4">
      Signing Protocol
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="4">
<label class="md-nav__title" for="nav-8-6-24-4">
        Signing Protocol
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/protocols/signing/custom_types/" title="Custom Types">
      Custom Types
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/protocols/signing/dialogues/" title="Dialogues">
      Dialogues
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/protocols/signing/message/" title="Message">
      Message
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/protocols/signing/serialization/" title="Serialization">
      Serialization
    </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-25" id="nav-8-6-25" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-25">
      Registries
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="3">
<label class="md-nav__title" for="nav-8-6-25">
        Registries
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/registries/base/" title="Base">
      Base
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/registries/filter/" title="Filter">
      Filter
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/registries/resources/" title="Resources">
      Resources
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-26" id="nav-8-6-26" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-26">
      Skills
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="3">
<label class="md-nav__title" for="nav-8-6-26">
        Skills
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/skills/base/" title="Base">
      Base
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/skills/behaviours/" title="Behaviors">
      Behaviors
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/skills/tasks/" title="Task">
      Task
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-27" id="nav-8-6-27" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-27">
      Test Tools
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="3">
<label class="md-nav__title" for="nav-8-6-27">
        Test Tools
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/test_tools/constants/" title="Constants">
      Constants
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/test_tools/exceptions/" title="Exceptions">
      Exceptions
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/test_tools/generic/" title="Generic">
      Generic
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/test_tools/test_cases/" title="Test Cases">
      Test Cases
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/test_tools/test_contract/" title="Test Contract">
      Test Contract
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/test_tools/test_skill/" title="Test Skill">
      Test Skill
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-28" id="nav-8-6-28" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-28">
      Plugins
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="3">
<label class="md-nav__title" for="nav-8-6-28">
        Plugins
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-28-1" id="nav-8-6-28-1" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-28-1">
      CLI
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="4">
<label class="md-nav__title" for="nav-8-6-28-1">
        CLI
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-28-1-1" id="nav-8-6-28-1-1" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-28-1-1">
      IPFS
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="5">
<label class="md-nav__title" for="nav-8-6-28-1-1">
        IPFS
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/plugins/aea_cli_ipfs/core/" title="API">
      API
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/plugins/aea_cli_ipfs/registry/" title="Registry">
      Registry
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/plugins/aea_cli_ipfs/ipfs_utils/" title="Utils">
      Utils
    </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-28-2" id="nav-8-6-28-2" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-28-2">
      Ledger
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="4">
<label class="md-nav__title" for="nav-8-6-28-2">
        Ledger
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-28-2-1" id="nav-8-6-28-2-1" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-28-2-1">
      Cosmos
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="5">
<label class="md-nav__title" for="nav-8-6-28-2-1">
        Cosmos
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/plugins/aea_ledger_cosmos/cosmos/" title="API">
      API
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-28-2-2" id="nav-8-6-28-2-2" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-28-2-2">
      Ethereum
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="5">
<label class="md-nav__title" for="nav-8-6-28-2-2">
        Ethereum
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/plugins/aea_ledger_ethereum/ethereum/" title="API">
      API
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6-28-2-3" id="nav-8-6-28-2-3" type="checkbox"/>
<label class="md-nav__link" for="nav-8-6-28-2-3">
      Fetchai
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="5">
<label class="md-nav__title" for="nav-8-6-28-2-3">
        Fetchai
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/plugins/aea_ledger_fetchai/fetchai/" title="API">
      API
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/plugins/aea_ledger_fetchai/_cosmos/" title="Helper">
      Helper
    </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../glossary/" title="Glossary">
      Glossary
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../questions-and-answers/" title="Q&amp;A">
      Q&amp;A
    </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#messages-and-data-structures">
    Messages and Data Structures
  </a>
<nav class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#agent-record">
    Agent Record
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-message">
    ACN Message
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#status">
    Status
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#register">
    Register
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lookuprequest">
    LookupRequest
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lookupresponse">
    LookupResponse
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#aeaenvelope">
    AeaEnvelope
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-protocol-interactions">
    ACN Protocol Interactions
  </a>
<nav class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#registration-interaction">
    "Registration" Interaction
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#look-up-interaction">
    "Look-up" Interaction
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#routing-interaction">
    "Routing" Interaction
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#joining-the-acn-network">
    Joining the ACN network
  </a>
<nav class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#relay-connections">
    Relay connections
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#delegate-connections">
    Delegate connections
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-transport">
    ACN transport
  </a>
<nav class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-envelope-entrance-agent-peer">
    ACN Envelope Entrance: Agent -&gt; Peer
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-envelope-routing">
    ACN Envelope Routing
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-envelope-exit-peer-agent">
    ACN Envelope Exit: Peer -&gt; Agent
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#connect-your-aea-to-the-acn">
    Connect your AEA to the ACN
  </a>
<nav class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#the-fetchaip2p_libp2p-connection">
    The fetchai/p2p_libp2p connection
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-fetchaip2p_libp2p_delegate-connection">
    The fetchai/p2p_libp2p_delegate connection
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#known-issues-and-limitations">
    Known issues and limitations
  </a>
<nav class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#delegate-client-on-client-disconnectionreconnection">
    Delegate client on client disconnection/reconnection
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#golang-node-python-client-libp2p-connection">
    Golang Node &lt;&gt; Python Client libp2p connection
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#what-a-peer-should-do-if-it-receives-an-acknowledgement-with-an-error">
    What a peer should do if it receives an acknowledgement with an error?
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#no-possibility-of-switching-peers">
    No possibility of switching peers
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<a class="md-icon md-content__icon" href="https://github.com/valory-xyz/open-aea/edit/master/docs/acn-internals.md" title="Edit this page"></a>
<h1>ACN Internals</h1>
<p>The aim of this document is to describe at a high-level
the main implementation of the Agent Communication Network (ACN).</p>
<p>In particular:</p>
<ul>
<li><a href="https://github.com/fetchai/agents-aea/tree/main/libs/go/libp2p_node" target="_blank">the <code>libp2p_node</code> Golang library<a></a>;</a></li>
<li><a href="https://github.com/fetchai/agents-aea/tree/main/packages/fetchai/connections/p2p_libp2p" target="_blank">the <code>p2p_libp2p</code> AEA connection, written in Python, that implements the <em>direct connection</em> with an ACN peer<a></a>;</a></li>
<li><a href="https://github.com/fetchai/agents-aea/tree/main/packages/fetchai/connections/p2p_libp2p_client" target="_blank">the <code>p2p_libp2p_client</code> AEA connection, written in Python, which implements the <em>delegate connection</em> with an ACN peer<a></a>.</a></li>
</ul>
<p>It is assumed the reader already knows what is the ACN and
its purposes; if not, we suggest reading <a href="../acn">this page<a></a>.</a></p>
<p>This documentation page is structured as follows:</p>
<ul>
<li>Firstly, the ACN protocol is described: all the messages
and data structures involved, as well as some example of interaction
protocol with these messages;</li>
<li>Then, it is explained how a peer can join an existing ACN network,
and the message exchange involved;</li>
<li>It follows the description of the journey of an envelope
  in the ACN network: from the agent connection to its contact
  peer, between ACN peers, and then from the contact peer of the
  destination agent to the target agent;</li>
<li>The following section describes the functionalities
  of the AEA connections that allow to communicate through
  the ACN: <code>fetchai/p2p_libp2p</code> and <code>fetchia/p2p_libp2p_delegate</code>;</li>
<li>The documentation ends with a section of known issues and limitations
  of the current implementation.</li>
</ul>
<h2 id="messages-and-data-structures">Messages and Data Structures</h2>
<p>At the foundation of the ACN there is the <em>ACN protocol</em>.
The protocol messages and the reply structure are generated from this 
<a href="https://github.com/fetchai/agents-aea/blob/develop/libs/go/libp2p_node/protocols/acn/v1_0_0/acn.yaml" target="_blank">protocol specification</a>,
using the <a href="../protocol-generator" target="_blank">protocol generator</a>.
Therefore, it uses <a href="https://developers.google.com/protocol-buffers" target="_blank">Protocol Buffers</a>
as a serialization format,
and the definition of the data structures involved is defined in this
<a href="https://github.com/fetchai/agents-aea/blob/develop/libs/go/libp2p_node/protocols/acn/v1_0_0/acn.proto" target="_blank"><code>.proto</code> file</a>.</p>
<p>To know more about the protocol generator, refer to the relevant
section of the documentation:
<a href="../protocol-generator" target="_blank">Protocol Generator</a>.</p>
<h3 id="agent-record">Agent Record</h3>
<p>An <em>agent record</em> is a data structure containing information about an
agent and its Proof-of-Representation (PoR) to be used by a peer for other peers.
This data structure is used as a payload in other ACN messages (see below).</p>
<p>The <code>AgentRecord</code> data structure contains the following fields:</p>
<ul>
<li><code>service_id</code>: a string describing the service identifier.</li>
<li><code>ledger_id</code>: a string. It is the identifier of the ledger 
    this agent record is associated to.
    Currently, the allowed values are:<ul>
<li><code>fetchai</code>, the identifier for the Fetch.AI ledger;</li>
<li><code>ethereum</code>, the identifier for the Ethereum ledger;</li>
<li><code>cosmos</code>, the identifier for the Cosmos ledger;</li>
</ul>
</li>
<li><code>address</code>: a string. It is the public key of a public-private key pair.
    It is used as an identifier for routing purposes.</li>
<li><code>public_key</code>: a string. The representative's public key. Used in case of (PoR).</li>
<li><code>peer_public_key</code>: a string. The public key of the peer.</li>
<li><code>signature</code>: a string. The signature for PoR.</li>
<li><code>not_before</code>: a string. Specify the lower bound for certificate validity.
    If it is a string, it must follow the format: <code>YYYY-MM-DD</code>. It will be interpreted as time zone UTC-0</li>
<li><code>not_after</code>: a string. Specify the upper bound for certificate validity. 
    If it is a string, it must follow the format: <code>YYYY-MM-DD</code>. It will be interpreted as time zone UTC-0.</li>
</ul>
<h3 id="acn-message">ACN Message</h3>
<p>Entities in the ACN (i.e. either agents or peers) exchange <em>ACN messages</em>.
An ACN message contains a <code>payload</code> field,
which is the actual content of the message.</p>
<p>There are different types of payloads:</p>
<ul>
<li><code>Status</code></li>
<li><code>Register</code></li>
<li><code>LookupRequest</code></li>
<li><code>LookupResponse</code></li>
<li><code>AeaEnvelope</code></li>
</ul>
<h3 id="status">Status</h3>
<p>The <code>Status</code> payload is used as a response message to inform 
the sender about the handling of certain requests.
The payload contains:</p>
<ul>
<li>the <code>status_code</code>, a positive integer among the ones in the 
  <a href="https://github.com/fetchai/agents-aea/blob/develop/libs/go/libp2p_node/protocols/acn/v1_0_0/acn.proto" target="_blank">Protobuf file</a>.</li>
<li>a list of error messages (string).</li>
</ul>
<p>A status code <code>0</code>, identified as <code>SUCCESS</code>, 
means that the request has been processed successfully.
Status codes greater than <code>0</code> can be:</p>
<ul>
<li>
<p>Generic errors: errors that occur under generic circumstances.</p>
<ul>
<li><code>ERROR_UNSUPPORTED_VERSION</code>, with integer value <code>1</code>: the receiver of the message
     does not support the protocol version of the sender;</li>
<li><code>ERROR_UNEXPECTED_PAYLOAD</code>, with integer value <code>2</code>: the payload could not be
     deserialised on the receiver side;</li>
<li><code>ERROR_GENERIC</code>, with integer value <code>3</code>: an internal error;</li>
<li><code>ERROR_SERIALIZATION</code>, with integer value <code>4</code>: a serialization error occurred
     on the receiving end;</li>
</ul>
</li>
<li>
<p>Register errors: errors that occur during agent registration operations in the ACN. </p>
<ul>
<li><code>ERROR_WRONG_AGENT_ADDRESS</code>, with integer value <code>10</code>:
     the PoR by a peer from another peer does not match the destination address of
     the envelope to be routed by the receiving peer.</li>
<li><code>ERROR_WRONG_PUBLIC_KEY</code>, with integer value <code>11</code>: the
     representative peer public key does not match the one in the agent record;</li>
<li><code>ERROR_INVALID_PROOF</code>, with integer value <code>12</code>: the signature is invalid;</li>
<li><code>ERROR_UNSUPPORTED_LEDGER</code>, with integer value <code>13</code>: the ledger of the PoR is not supported by the peer;</li>
</ul>
</li>
<li>
<p>Lookup and delivery errors: errors that occur during lookup to the DHT and envelope delivery operations in the ACN.</p>
<ul>
<li><code>ERROR_UNKNOWN_AGENT_ADDRESS</code>, with integer value <code>20</code>: the requested agent address has not been found in the local DHT of the peer;</li>
<li><code>ERROR_AGENT_NOT_READY</code>, with integer value <code>21</code>: the agent is not ready for envelope delivery.</li>
</ul>
</li>
</ul>
<h3 id="register">Register</h3>
<p>The <code>Register</code> payload is used to request a peer to register an agent among his known ones.
The payload contains the field <code>record</code>, which is an instance of <code>AgentRecord</code>.</p>
<h3 id="lookuprequest">LookupRequest</h3>
<p>The <code>LookupRequest</code> payload is sent between peer to look-up addresses in the Distributed Hash Table (DHT).
It contains the agent address (a string) that the sender needs to correctly route an envelope.</p>
<h3 id="lookupresponse">LookupResponse</h3>
<p>The <code>LookupResponse</code> payload is the response sent by a peer that received a <code>LookupRequest</code>.
It contains the <code>AgentRecord</code> associated to the requested address.</p>
<h3 id="aeaenvelope">AeaEnvelope</h3>
<p>The <code>AeaEnvelope</code> payload contains the envelope sent by an agent and to be delivered to another agent.
It contains:</p>
<ul>
<li><code>envelope</code>: the envelope to be forwarded, in byte representation;</li>
<li>an <code>AgentRecord</code> (see above).</li>
</ul>
<h2 id="acn-protocol-interactions">ACN Protocol Interactions</h2>
<p>The ACN protocol specifies three different possible interactions:</p>
<ul>
<li>the <em>registration</em> interaction</li>
<li>the <em>look-up</em> interaction</li>
<li>the <em>routing</em> interaction</li>
</ul>
<h3 id="registration-interaction">"Registration" Interaction</h3>
<p>The registration interaction is used by delegate agents or relayed peers
to register themselves to another peer.</p>
<div class="mermaid">
    sequenceDiagram
        participant Agent/RelayedPeer
        participant Peer
        Agent/RelayedPeer-&gt;&gt;Peer: Register(AgentRecord)
        alt success
            note over Peer: check PoR
            Peer-&gt;&gt;Agent/RelayedPeer: Status(SUCCESS)
        else wrong agent address
            Peer-&gt;&gt;Agent/RelayedPeer: Status(ERROR_WRONG_AGENT_ADDRESS)
        else wrong public key
            Peer-&gt;&gt;Agent/RelayedPeer: Status(ERROR_WRONG_PUBLIC_KEY)
        else invalid proof of representation
            Peer-&gt;&gt;Agent/RelayedPeer: Status(ERROR_INVALID_PROOF)
        else unsupported ledger
            Peer-&gt;&gt;Agent/RelayedPeer: Status(ERROR_UNSUPPORTED_LEDGER)
        end
</div>
<h3 id="look-up-interaction">"Look-up" Interaction</h3>
<p>The look-up interaction is used by a peer
to request information to another peer about an agent address.</p>
<div class="mermaid">
    sequenceDiagram
        participant Peer1
        participant Peer2
        Peer1-&gt;&gt;Peer2: LookupRequest(address)
        alt success
            Peer2-&gt;&gt;Peer1: LookupResponse(AgentRecord)
        else unknown agent address
            Peer2-&gt;&gt;Peer1: Status(ERROR_UNKNOWN_AGENT_ADDRESS)
        end
</div>
<h3 id="routing-interaction">"Routing" Interaction</h3>
<p>The routing interaction is used by agents
and peers to route the envelope through the ACN.</p>
<div class="mermaid">
    sequenceDiagram
        participant Peer1
        participant Peer2
        Peer1-&gt;&gt;Peer2: AeaEnvelope(envelope, AgentRecord)
        alt success
            note over Peer2: check PoR
            Peer2-&gt;&gt;Peer1: Status(SUCCESS)
        else error on decoding of Envelope payload
            Peer2-&gt;&gt;Peer1: Status(ERROR_SERIALIZATION)
        else PoR errors
            note over Peer1,Peer2: see above 
        end

</div>
<h2 id="joining-the-acn-network">Joining the ACN network</h2>
<p>When an ACN peer wants to join the network, it has
to start from a list of <em>bootstrap peers</em>, i.e.
a list of ACN peers to connect with (at least one).</p>
<p>Each node handles four different types of <a href="https://docs.libp2p.io/concepts/stream-multiplexing/" target="_blank">libp2p streams</a>:</p>
<ul>
<li>the <em>notification stream</em>, identified by the URI <code>/aea-notif/</code>:
  this stream is used by new peers to notify their existence to</li>
<li>the <em>address stream</em>, identified by the URI <code>/aea-address/</code>:
  used to send look-up requests and look-up responses;</li>
<li>the <em>envelope stream</em>, identified by the URI <code>/aea/</code>:
  used to forward and to receive ACN envelopes;</li>
<li>the <em>register relay stream</em>, identified by the URI <code>/aea-register/</code>:
  this is to receive messages from clients that want to register their agents addresses;
  this peer, and then it can register their addresses.</li>
</ul>
<p>To begin with, the node process initializes
the transport connections with the bootstrap peers,
the local copy of the Kademlia Distributed
Hash Table (DHT), 
the persistent storage for agent records,
and performs other non-functional operations 
like setting up the <a href="https://prometheus.io/" target="_blank"> Prometheus monitoring system</a>.
Optionally, can also start listening for relay connections
and delegate connections.</p>
<p>Then, it sets up the notification stream and notifies the bootstrap peers (if any).</p>
<div class="mermaid">
    sequenceDiagram
        participant Peer1
        participant Peer2
        participant Peer3
        note over Peer1: notify<br/>bootstrap peers
        Peer1-&gt;&gt;Peer2: notify
        Peer2-&gt;&gt;Peer2: wait until notifying peer <br/>added to DHT
        activate Peer2
        Peer1-&gt;&gt;Peer3: notify
        Peer3-&gt;&gt;Peer3: wait until notifying peer <br/>added to DHT
        activate Peer3
        note over Peer2,Peer3: Peer1 registered to DHT
        deactivate Peer2
        deactivate Peer3
        loop for each local/relay/delegate address 
            Peer1-&gt;&gt;Peer1: compute CID from address
            Peer1-&gt;&gt;Peer2: register address
            Peer1-&gt;&gt;Peer3: register address
        end
        note over Peer1: set up:<br/>- address stream<br/>- envelope stream<br/>- register relay stream
</div>
<h3 id="relay-connections">Relay connections</h3>
<p>If the ACN node is configured to run the relay service,
it sets up the register relay stream, waiting for registration
requests.</p>
<p>The following diagram shows an example of the message exchanged
during a registration request:</p>
<div class="mermaid">
    sequenceDiagram
        participant Agent
        participant Peer
        Agent-&gt;&gt;Peer: Register
        alt decoding error of ACN message
            Peer-&gt;&gt;Agent: Status(ERROR_SERIALIZATION)
        else wrong payload
            Peer-&gt;&gt;Agent: Status(ERROR_UNEXPECTED_PAYLOAD)
        else PoR check fails
            alt wrong agent address
                Peer-&gt;&gt;Agent: Status(ERROR_WRONG_AGENT_ADDRESS)
            else unsupported ledger
                Peer-&gt;&gt;Agent: Status(ERROR_UNSUPPORTED_LEDGER)
            else agent address and public key don't match
                Peer-&gt;&gt;Agent: Status(ERROR_WRONG_AGENT_ADDRESS)
            else invalid proof
                Peer-&gt;&gt;Agent: Status(ERROR_INVALID_PROOF)
            end
        else PoR check succeeds
            Peer-&gt;&gt;Agent: Status(SUCCESS)
            note over Peer: announce agent address<br/>to other peers
        end
</div>
<h3 id="delegate-connections">Delegate connections</h3>
<p>If the ACN node is configured to run the delegate service,
it start listening from a TCP socket at a configurable URI.</p>
<p>To see a diagram of the message exchanged
during a registration request read 
<a href="../acn-internals#registration-interaction" target="_blank">this section</a>.</p>
<h2 id="acn-transport">ACN transport</h2>
<p>In the following sections, we describe the main three steps of the routing
of an envelope through the ACN:</p>
<ul>
<li><em>ACN entrance</em>: when an envelope sent by an agent enters 
  the peer-to-peer network via the peer the agent is connected to
  i.e. agent-to-peer communication;</li>
<li><em>ACN routing</em>: when an envelope gets routed through the peer-to-peer network,
  i.e. peer-to-peer communication;</li>
<li><em>ACN exit</em>: when an envelope gets delivered to the receiving agent
  through its representative peer, i.e. peer-to-agent communication.</li>
</ul>
<h3 id="acn-envelope-entrance-agent-peer">ACN Envelope Entrance: Agent -&gt; Peer</h3>
<p>In this section, we will describe the interaction protocols between agents and peers 
for the messages sent by the agent to the ACN network;
in particular, the communication from the contact peer of an agent to the agent.</p>
<p>The following diagram explains the exchange of messages on entering an envelope in the ACN.</p>
<p>In the case of <em>direct connection</em>, 
<code>Agent</code> is a Python process, whereas <code>Peer</code> is in a separate (Golang) process.
The logic of the Python Agent client is implemented in 
the <a href="https://github.com/fetchai/agents-aea/tree/main/packages/fetchai/connections/p2p_libp2p" target="_blank">AEA connection <code>fetchai/p2p_libp2p</code></a>
The communication between <code>Agent</code> and <code>Peer</code> is done through 
an OS pipe for Inter-Process Communication (IPC) between the AEA's process and the libp2p node process;
then, the message gets enqueued to an output queue by an input coroutine.
Finally, the envelope ends up in an output queue, 
which is processed by an output coroutine and routed to the next peer.</p>
<p>In the case of <em>delegate connection</em>, 
the message exchange is very similar; however, instead of using 
pipes, the communication is done through the network, i.e. TCP,
with a peer which has the delegate service enabled.
The logic of the <code>Agent</code> client connected with a delegate connection
is implemented in 
the <a href="https://github.com/fetchai/agents-aea/tree/main/packages/fetchai/connections/p2p_libp2p_client" target="_blank">AEA connection <code>fetchai/p2p_libp2p_client</code></a> </p>
<div class="mermaid">
    sequenceDiagram
        participant Agent
        participant Peer
        loop until Status(success) received
            Agent-&gt;&gt;Peer: AeaEnvelope
            Agent-&gt;&gt;Agent: wait
            note left of Agent: Wait until<br/>Status(success)
            alt successful case
                Peer-&gt;&gt;Agent: Status(success)
                note over Agent: break loop
            else ack-timeout OR conn-error
                note left of Agent: continue: Try to<br/>resend/reconnect
            else version not supported
                Peer-&gt;&gt;Agent: Status(ERROR_UNSUPPORTED_VERSION)
            else error on decoding of ACN message
                Peer-&gt;&gt;Agent: Status(ERROR_SERIALIZATION)
            else error on decoding of Envelope payload
                Peer-&gt;&gt;Agent: Status(ERROR_SERIALIZATION)
            else the payload cannot be handled
                Peer-&gt;&gt;Agent: Status(ERROR_UNEXPECTED_PAYLOAD)
            end
        end
        note over Peer: route envelope<br/>to next peer
</div>
<h3 id="acn-envelope-routing">ACN Envelope Routing</h3>
<p>In this section, we describe the interaction between peers
when it comes to envelope routing.</p>
<p>Assume an envelope arrives from an agent to peer <code>Peer1</code>,
i.e. <code>Peer1</code> is the first hop 
of the routing.
Let <code>Agent</code> be the local agent directly connected
to <code>Peer1</code>, <code>Peer2</code> a direct peer
of peer <code>Peer1</code>.</p>
<p>When the envelope is leaving <code>Peer1</code>,
we may have different scenario:</p>
<p>1) In case of direct connection,
   and the field <code>sender</code> of the envelope
   is not the local agent address: 
   the message is considered invalid, and it is dropped. </p>
<div class="mermaid">
    sequenceDiagram
        participant Agent
        participant Peer1
        participant Peer2
        Agent-&gt;&gt;Peer1: AeaEnvelope
        alt envelope sender not registered locally
            note over Peer1: stop, log error
        end
</div>
<p>2) the <code>target</code> of the envelope is 
   the local agent connected to the peer:
   the envelope is routed to the local agent.</p>
<div class="mermaid">
    sequenceDiagram
        participant Agent
        participant Peer1
        participant Peer2
        Agent-&gt;&gt;Peer1: AeaEnvelope
        alt target == peer1.my_agent
            note over Peer1: envelope destinated<br/> to local agent,<br/> not routing
            loop agent not ready
                note over Peer1: sleep for 100ms
            end
            Peer1-&gt;&gt;Agent: AeaEnvelope
            Agent-&gt;&gt;Peer1: Status(Success)
        end
</div>
<p>3) the <code>target</code> is a delegate client.
   Send the envelope via TCP.</p>
<div class="mermaid">
    sequenceDiagram
        participant Delegate
        participant Peer1
        participant Peer2
        Delegate-&gt;&gt;Peer1: AeaEnvelope
        alt destination is a delegate
            note over Peer1: send envelope<br/> to delegate via TCP
            Peer1-&gt;&gt;Delegate: AeaEnvelope
            Delegate-&gt;&gt;Peer1: Status(Success)
        end
</div>
<p>4) Otherwise, look up the local DHT.
  If an entry is found, use it;
   otherwise, send a look-up request
   to connected peers.</p>
<div class="mermaid">
    sequenceDiagram
        participant Agent
        participant Peer1
        participant Peer2
        Agent-&gt;&gt;Peer1: AeaEnvelope
        alt address found in DHT
            note over Peer1: destination is a<br/>relay client
        else lookup address in DHT
            note over Peer1: send lookup request<br/> to all peers
            Peer1-&gt;&gt;Peer2: LookupRequest
            alt generic error
                Peer2-&gt;&gt;Peer1: Status(GENERIC_ERROR)
            else look-up response
                Peer2-&gt;&gt;Peer1: LookupResponse
                note over Peer1: Check PoR
            else not found
                Peer2-&gt;&gt;Peer1:Status(UNKNOWN_AGENT_ADDRESS)
            end
        end
        note over Peer1,Peer2: Now Peer1 knows the contact peer<br/>is PeerX
</div>
<p>In particular, when a peer receives a LookupRequest message,
it does the following:</p>
<div class="mermaid">
    sequenceDiagram
        participant Peer1
        participant Peer2
        Peer1-&gt;&gt;Peer2: LookupRequest
        alt error
            Peer2-&gt;&gt;Peer1: Status(Error)
        else local agent/relay/delegate
            note over Peer2: requested address is<br/>a local agent<br/>OR<br/>requested address is<br/>in my relay clients<br/>OR<br/>requested address is<br/>in my delegate clients
            Peer2-&gt;&gt;Peer1: LookupResponse
            note over Peer1: Check PoR
        else not found locally
            note over Peer2: send lookup request<br/>to other peers...
            alt found
                Peer2-&gt;&gt;Peer1: LookupResponse
                note over Peer1: Check PoR
            else not found
                Peer2-&gt;&gt;Peer1:Status(UNKNOWN_AGENT_ADDRESS)
            end
        end
</div>
<p>Let <code>Peer3</code> the contact peer of the recipient of the envelope. 
The following diagram shows how the contact peer of the 
envelope recipient handles the incoming envelope:</p>
<div class="mermaid">
    sequenceDiagram
        participant Peer1
        participant Peer3
        Peer1-&gt;&gt;Peer3: AeaEnvelope
        alt decoding error of ACN message
            Peer3-&gt;&gt;Peer1: Status(ERROR_SERIALIZATION)
        else unexpected payload
            Peer3-&gt;&gt;Peer1: Status(ERROR_UNEXPECTED_PAYLOAD)
        else decoding error of envelope payload
            Peer3-&gt;&gt;Peer1: Status(ERROR_SERIALIZATION)        
        else PoR check fails
            alt wrong agent address
                Peer3-&gt;&gt;Peer1: Status(ERROR_WRONG_AGENT_ADDRESS)
            else unsupported ledger
                Peer3-&gt;&gt;Peer1: Status(ERROR_UNSUPPORTED_LEDGER)
            else agent address and public key don't match
                Peer3-&gt;&gt;Peer1: Status(ERROR_WRONG_AGENT_ADDRESS)
            else invalid proof
                Peer3-&gt;&gt;Peer1: Status(ERROR_INVALID_PROOF)
            end
        else PoR check succeeds
            alt target is delegate, not ready
                Peer3-&gt;&gt;Peer1: Status(ERROR_AGENT_NOT_READY)
            else exists delegate, ready
                note over Peer3: forward envelope via<br/>delegate connection
                Peer3-&gt;&gt;Peer1: Status(SUCCESS)
            else target is local agent, not ready
                Peer3-&gt;&gt;Peer1: Status(ERROR_AGENT_NOT_READY)
            else target is local agent, ready
                note over Peer3: forward envelope via<br/>direct connection
                Peer3-&gt;&gt;Peer1: Status(SUCCESS)
            else agent does not exist
                Peer3-&gt;&gt;Peer1: Status(ERROR_UNKNOWN_AGENT_ADDRESS)
            end
        end
</div>
<h3 id="acn-envelope-exit-peer-agent">ACN Envelope Exit: Peer -&gt; Agent</h3>
<p>The following diagram explains the exchange of messages on exiting an envelope in the ACN.
That is, the communication from the contact peer of an agent to the agent.</p>
<p>The same message exchange is done 
both in the case of direct connection and
delegate connection,
similarly for what has been described for the envelope entrance
<a href="../acn-internals#acn-envelope-entrance-agent-peer">(see above)</a>.</p>
<div class="mermaid">
    sequenceDiagram
        participant Agent
        participant Peer
        Peer-&gt;&gt;Agent: AeaEnvelope
        alt successful case
            Agent-&gt;&gt;Peer: Status(success)
        else ack-timeout OR conn-error
            note left of Peer: do nothing
        else error on decoding of ACN message
            Agent-&gt;&gt;Peer: Status(GENERIC_ERROR)
        else error on decoding of Envelope payload
            Agent-&gt;&gt;Peer: Status(GENERIC_ERROR)
        else wrong payload
            Agent-&gt;&gt;Peer: Status(GENERIC_ERROR)
        end
</div>
<h2 id="connect-your-aea-to-the-acn">Connect your AEA to the ACN</h2>
<p>To connect the AEA to the ACN network,
there are two AEA connections available:</p>
<ul>
<li>the <code>fetchai/p2p_libp2p</code>, that implements
  a direct connection, and</li>
<li>the <code>fetchai/p2p_libp2p_delegate</code> connection,
  that implements the delegate connection.</li>
</ul>
<p>For more information on the AEA connection package type,
refer to <a href="../connection/" target="_blank">this guide</a>.</p>
<h3 id="the-fetchaip2p_libp2p-connection">The <code>fetchai/p2p_libp2p</code> connection</h3>
<p>The source code of the <code>fetchai/p2p_libp2p</code> connection<br/>
can be downloaded from 
<a href="https://aea-registry.fetch.ai/details/connection/fetchai/p2p_libp2p/latest" target="_blank">the AEA Registry</a>,
or from <a href="https://github.com/fetchai/agents-aea/tree/main/packages/fetchai/connections/p2p_libp2p" target="_blank">the main AEA framework repository.</a></p>
<p>The package provides the connection class <code>P2PLibp2pConnection</code>,
which implements the <code>Connection</code> interface and
therefore can be used by the Multiplexer as any other connection.</p>
<ul>
<li>The <code>connect</code> method of this connection spawns a new instance
  of the <a href="https://github.com/fetchai/agents-aea/blob/main/libs/go/libp2p_node/libp2p_node.go" target="_blank"><code>libp2p_node</code> program</a>
(i.e. an ACN peer node) and connects to it through OS pipes. 
Then, it sets up the <em>message receiving loop</em>,
  which enqueues messages in the input queue to be read by <code>read</code> method calls,
  and the <em>message sending loop</em>, 
  which dequeues messages from the output queue and forwards them to the Libp2p node. 
The loops are run concurrently in the Multiplexer thread, 
  using the Python asynchronous programming library <code>asyncio</code>.  </li>
</ul>
<div class="mermaid">
    sequenceDiagram
        participant Libp2p Connection
        participant sending loop
        participant receiving loop
        participant Libp2p Node
        Libp2p Connection-&gt;&gt;Libp2p Node: spawn process
        activate Libp2p Node
        Libp2p Connection-&gt;&gt;sending loop: start recv loop
        sending loop-&gt;&gt;sending loop: wait messages from output queue
        activate sending loop
        Libp2p Connection-&gt;&gt;receiving loop: start send loop
        receiving loop-&gt;&gt;receiving loop: wait messages from input queue
        activate receiving loop
        deactivate Libp2p Node
        deactivate sending loop
        deactivate receiving loop
</div>
<ul>
<li>The <code>send</code> method enqueues a message in the output queue.
The message is then dequeued by the sending loop,
and then sent to the Libp2p node. </li>
</ul>
<div class="mermaid">
    sequenceDiagram
        participant Libp2p Connection
        participant sending loop
        participant Libp2p Node
        activate sending loop
        Libp2p Connection-&gt;&gt;Libp2p Connection: enqueue message to output queue
        sending loop-&gt;&gt;sending loop: dequeue message from output queue
        deactivate sending loop
        sending loop-&gt;&gt;Libp2p Node: AeaEnvelope
        sending loop-&gt;&gt;sending loop: wait for status
        activate sending loop
        alt success
            note over Libp2p Node: route envelope
            Libp2p Node-&gt;&gt;sending loop: Status(SUCCESS)
            deactivate sending loop
            note over sending loop: OK
        else timed out
            note over sending loop: raise with error
        else acn message decoding error 
            Libp2p Node-&gt;&gt;sending loop: Status(ERROR_SERIALIZATION)
        else unexpected payload
            Libp2p Node-&gt;&gt;sending loop: Status(ERROR_UNEXPECTED_PAYLOAD)
        else envelope decoding error 
            Libp2p Node-&gt;&gt;sending loop: Status(ERROR_SERIALIZATION)
        end
</div>
<ul>
<li>The <code>receive</code> method dequeues a message from the input queue.
The queue is populated by the receiving loop,
which receives messages from the Libp2p node. </li>
</ul>
<div class="mermaid">
    sequenceDiagram
        participant Libp2p Connection
        participant receiving loop
        participant Libp2p Node
        activate receiving loop
        Libp2p Node-&gt;&gt;receiving loop: AeaEnvelope
        deactivate receiving loop
        Libp2p Node-&gt;&gt;Libp2p Node: wait for status
        activate Libp2p Node
        alt success
            note over receiving loop: enqueue envelope<br/>to input queue
            receiving loop-&gt;&gt;Libp2p Node: Status(SUCCESS)
            deactivate Libp2p Node
            note over receiving loop: OK
        else timed out
            note over Libp2p Node: ignore
        else acn message decoding error 
            receiving loop-&gt;&gt;Libp2p Node: Status(ERROR_SERIALIZATION)
        else unexpected payload
            receiving loop-&gt;&gt;Libp2p Node: Status(ERROR_UNEXPECTED_PAYLOAD)
        else envelope decoding error 
            receiving loop-&gt;&gt;Libp2p Node: Status(ERROR_SERIALIZATION)
        end
        Libp2p Connection-&gt;&gt;receiving loop: read message from output queue
        note over Libp2p Connection: return message<br/>to Multiplexer
</div>
<ul>
<li>the <code>disconnect</code> method stops both the receiving loop and the sending loop,
  and stops the Libp2p node.</li>
</ul>
<h3 id="the-fetchaip2p_libp2p_delegate-connection">The <code>fetchai/p2p_libp2p_delegate</code> connection</h3>
<p>The source code of the <code>fetchai/p2p_libp2p_delegate</code> connection<br/>
can be downloaded from
<a href="https://aea-registry.fetch.ai/details/connection/fetchai/p2p_libp2p_client/latest" target="_blank">the main AEA framework repository.</a>
or from <a href="https://github.com/fetchai/agents-aea/tree/main/packages/fetchai/connections/p2p_libp2p_client" target="_blank">the main AEA framework repository.</a></p>
<p>The package provides the connection class <code>P2PLibp2pClientConnection</code>,
which implements the <code>Connection</code> interface and
therefore can be used by the Multiplexer as any other connection.</p>
<ul>
<li>The <code>connect</code> method of this connection will set up a TCP
  connection to the URI of the delegate peer. Then, it will
  send a <code>Register</code> request to register the agent among the peer's
  client connections.
  On registration success, it sets up the <em>message receiving loop</em>, 
  which enqueues messages in the input queue to be read by read method calls, 
  and the <em>message sending loop</em>, which dequeues messages from the output queue 
  and forwards them to the Libp2p node. 
  The loops are run concurrently in the Multiplexer thread, 
  using the Python asynchronous programming library <code>asyncio</code>.</li>
</ul>
<div class="mermaid">
    sequenceDiagram
        participant Libp2p Client Connection
        participant Libp2p Node
        activate Libp2p Node
        Libp2p Node-&gt;&gt;Libp2p Node: listening for TCP connections
        Libp2p Client Connection-&gt;&gt;Libp2p Node: Register (via TCP)
        deactivate Libp2p Node
        alt decoding error of ACN message
            Libp2p Node-&gt;&gt;Libp2p Client Connection: Status(ERROR_SERIALIZATION)
        else wrong payload
            Libp2p Node-&gt;&gt;Libp2p Client Connection: Status(ERROR_UNEXPECTED_PAYLOAD)
        else PoR check fails
            alt wrong agent address
                Libp2p Node-&gt;&gt;Libp2p Client Connection: Status(ERROR_WRONG_AGENT_ADDRESS)
            else unsupported ledger
                Libp2p Node-&gt;&gt;Libp2p Client Connection: Status(ERROR_UNSUPPORTED_LEDGER)
            else agent address and public key don't match
                Libp2p Node-&gt;&gt;Libp2p Client Connection: Status(ERROR_WRONG_AGENT_ADDRESS)
            else invalid proof
                Libp2p Node-&gt;&gt;Libp2p Client Connection: Status(ERROR_INVALID_PROOF)
            end
        else PoR check succeeds
            Libp2p Node-&gt;&gt;Libp2p Client Connection: Status(SUCCESS)
            note over Libp2p Node: announce agent<br/>address to<br/>other peers
            Libp2p Node-&gt;&gt;Libp2p Node: wait data from socket 
            activate Libp2p Node
            deactivate Libp2p Node
        end
</div>
<ul>
<li>
<p>The <code>send</code> method and the <code>receive</code> methods behave similarly to
  the <code>send</code> and <code>receive</code> methods of the
  <a href="../acn-internals#the-fetchaip2p_libp2p-connection" target="_blank"><code>p2p_libp2p connection</code></a>, 
  in terms of message exchange;
  however, the communication is done via TCP rather than pipes.</p>
</li>
<li>
<p>The <code>disconnect</code> method interrupts the connection with the delegate peer,
  without explicitly unregistering.</p>
</li>
</ul>
<h2 id="known-issues-and-limitations">Known issues and limitations</h2>
<p>In this section, we provide a list of known issues
and limitations of the current implementation
of the ACN, considering both the ACN nodes (written in Golang)
and the AEA connections, for the Python AEA framework, to interact with them.</p>
<h3 id="delegate-client-on-client-disconnectionreconnection">Delegate client on client disconnection/reconnection</h3>
<p>In case of disconnection/reconnection, delegate client record will be removed.
This can cause two problems: either the delegate client is not found, 
or connection is closed during the send operation.</p>
<p>Possible solutions:</p>
<ul>
<li>Create more complicated structure for clients storage;</li>
<li>Keep the delegate client record for longer; </li>
<li>Clean up the record by timeout, per client queues.</li>
</ul>
<p>Code references:</p>
<ul>
<li>record removed: <a href="https://github.com/fetchai/agents-aea/blob/1db1720081969bcec1be5a2000ca176475d2b487/libs/go/libp2p_node/dht/dhtpeer/dhtpeer.go#L864" target="_blank">https://github.com/fetchai/agents-aea/blob/1db1720081969bcec1be5a2000ca176475d2b487/libs/go/libp2p_node/dht/dhtpeer/dhtpeer.go#L864</a></li>
<li>send code: <a href="https://github.com/fetchai/agents-aea/blob/1db1720081969bcec1be5a2000ca176475d2b487/libs/go/libp2p_node/dht/dhtpeer/dhtpeer.go#L955" target="_blank">https://github.com/fetchai/agents-aea/blob/1db1720081969bcec1be5a2000ca176475d2b487/libs/go/libp2p_node/dht/dhtpeer/dhtpeer.go#L955</a></li>
</ul>
<h3 id="golang-node-python-client-libp2p-connection">Golang Node &lt;&gt; Python Client <code>libp2p</code> connection</h3>
<p>In case of connection between the Golang side (i.e. ACN node) 
and the Python side (i.e. the <code>libp2p</code> AEA connection) is broken, 
there is no reconnection attempt.
The Golang side connect to the Python server opened, 
but if the connection is broken Golang can try to reconnect; 
however, the Python side does not know about this and will restart
the node completely.</p>
<p>Possible solutions: the problem requires updates on both sides and assume possible timeouts on broken connection.
If connection is broken, the Python side awaits for reconnection from Golang side, 
and restart node completely after timeout.</p>
<h3 id="what-a-peer-should-do-if-it-receives-an-acknowledgement-with-an-error">What a peer should do if it receives an acknowledgement with an error?</h3>
<p>If an ACN response is the <code>Status</code> with error code different from <code>SUCCESS</code>,
the forwarding to other peers is not repeated. </p>
<p>A possible solution is to resend the message; however,
not clear why it should help in case of healthy connection,
how many times the sender should retry, and how it would help.</p>
<p>Discussion on GitHub: 
<a href="https://github.com/fetchai/agents-aea/pull/2509#discussion_r642628983" target="_blank">https://github.com/fetchai/agents-aea/pull/2509#discussion_r642628983</a></p>
<h3 id="no-possibility-of-switching-peers">No possibility of switching peers</h3>
<p>In case of a peer becoming unavailable, a delegate client or relay client currently has no means to automatically switch the peer. In particular, the DHT should be updated when a client switches peers.</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a class="md-flex md-footer-nav__link md-footer-nav__link--prev" href="../acn/" rel="prev" title="Agent Communication Network">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
                  Previous
                </span>
                Agent Communication Network
              </span>
</div>
</a>
<a class="md-flex md-footer-nav__link md-footer-nav__link--next" href="../simple-oef/" rel="next" title="Simple OEF">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
                  Next
                </span>
                Simple OEF
              </span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" rel="noopener" target="_blank">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs</a>
</div>
</div>
</div>
</footer>
</div>
<script src="../assets/javascripts/application.c33a9706.js"></script>
<script>app.initialize({version:"1.1",url:{base:".."}})</script>
<script src="https://unpkg.com/mermaid@8.10.1/dist/mermaid.min.js"></script>
</body>
</html>