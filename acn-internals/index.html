
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Everything you need to know about (open) AEAs." name="description"/>
<meta content="developer@fetch.ai,info@valory.xyz" name="author"/>
<link href="https://valory-xyz.github.io/open-aea/acn-internals/" rel="canonical"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.3.0, mkdocs-material-8.2.8" name="generator"/>
<title>ACN Internals - open-aea</title>
<link href="../assets/stylesheets/main.644de097.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.e6a45f82.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../stylesheets/extra.css" rel="stylesheet"/>
<script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="none" data-md-color-primary="none" data-md-color-scheme="" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#messages-and-data-structures">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="open-aea" class="md-header__button md-logo" data-md-component="logo" href=".." title="open-aea">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            open-aea
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              ACN Internals
            
          </span>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/valory-xyz/open-aea" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="open-aea" class="md-nav__button md-logo" data-md-component="logo" href=".." title="open-aea">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"></path></svg>
</a>
    open-aea
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/valory-xyz/open-aea" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
        Introduction
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../version/">
        Version
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../upgrading/">
        Upgrading
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4">
          Concepts
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Concepts" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Concepts
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../agent-oriented-development/">
        Agent-oriented development
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../vision/">
        Vision
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../app-areas/">
        Application areas
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../identity/">
        Identity
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../trust/">
        Trust minimisation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../language-agnostic-definition/">
        Language Agnostic Definition
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../registry/">
        Agent &amp; component registry
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5">
          Demos
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Demos" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          Demos
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../demos/">
        Demos
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../echo_demo/">
        Echo Demo
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../http-echo-demo/">
        HTTP Echo Demo
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../gym-skill/">
        Gym skill
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../aev-echo-demo/">
        Configure with Environment Variables
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6">
          Development - Beginner
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Development - Beginner" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
          Development - Beginner
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../quickstart/">
        AEA quick start
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../core-components-1/">
        Core components - Part 1
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../aea-vs-mvc/">
        AEA and web frameworks
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../core-components-2/">
        Core components - Part 2
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../interaction-protocol/">
        How AEAs talk to each other - interaction protocols
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development-setup/">
        Development setup
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/">
        Logging
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../debug/">
        Debugging
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7">
          Development - Intermediate
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Development - Intermediate" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
          Development - Intermediate
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1" id="__nav_7_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_7_1">
          Developing New Components
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Developing New Components" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_1">
<span class="md-nav__icon md-icon"></span>
          Developing New Components
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../step-one/">
        Ways to build an AEA
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../build-aea-step-by-step/">
        Build an AEA with the CLI
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../scaffolding/">
        Scaffolding packages
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../protocol-generator/">
        Generating protocols
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_2" id="__nav_7_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_7_2">
          Architecture &amp; component deep-dives
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Architecture &amp; component deep-dives" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_2">
<span class="md-nav__icon md-icon"></span>
          Architecture &amp; component deep-dives
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../design-principles/">
        Design principles
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../diagram/">
        Architectural diagram
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../connection/">
        Connections
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../protocol/">
        Protocols
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../skill/">
        Skills
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../contract/">
        Contracts
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../decision-maker/">
        Decision Maker
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ledger-integration/">
        Ledger &amp; Crypto APIs
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../message-routing/">
        Message routing
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../config/">
        Configurations
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../limits/">
        Limitations of v1
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_3" id="__nav_7_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_7_3">
          Use Case
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Use Case" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_3">
<span class="md-nav__icon md-icon"></span>
          Use Case
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../connect-a-frontend/">
        Front-end intergration
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../http-connection-and-skill/">
        HTTP Connection
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../raspberry-set-up/">
        Build an AEA on a Raspberry Pi
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" id="__nav_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_8">
          Development - Advanced
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Development - Advanced" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
          Development - Advanced
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_1" id="__nav_8_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_1">
          Topic Guides
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Topic Guides" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_8_1">
<span class="md-nav__icon md-icon"></span>
          Topic Guides
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../generic-storage/">
        Generic Storage
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../multi-agent-manager/">
        Multi agent manager
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../multiplexer-standalone/">
        Use multiplexer stand-alone
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../standalone-transaction/">
        Create stand-alone transaction
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../decision-maker-transaction/">
        Create decision-maker transaction
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../skill-testing/">
        Testing Skills
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../deployment/">
        Deployment
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../12-factor/">
        12-Factor app and AEAs
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../known-limits/">
        Known limitations
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../build-aea-programmatically/">
        Build an AEA programmatically
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../agent-vs-aea/">
        AEAs vs agents
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../modes/">
        Modes of running an AEA
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../runtime-cost/">
        Profiling
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../por/">
        Proof of Representation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../security/">
        Security
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_2" id="__nav_8_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_2">
          Agent Communication
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Agent Communication" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_8_2">
<span class="md-nav__icon md-icon"></span>
          Agent Communication
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../acn/">
        Agent Communication Network
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../p2p-connection/">
        ACN Connections
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          ACN Internals
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        ACN Internals
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#messages-and-data-structures">
    Messages and Data Structures
  </a>
<nav aria-label="Messages and Data Structures" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#agent-record">
    Agent Record
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-message">
    ACN Message
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#status">
    Status
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#register">
    Register
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lookuprequest">
    LookupRequest
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lookupresponse">
    LookupResponse
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#aeaenvelope">
    AeaEnvelope
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-protocol-interactions">
    ACN Protocol Interactions
  </a>
<nav aria-label="ACN Protocol Interactions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#registration-interaction">
    "Registration" Interaction
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#look-up-interaction">
    "Look-up" Interaction
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#routing-interaction">
    "Routing" Interaction
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#joining-the-acn-network">
    Joining the ACN network
  </a>
<nav aria-label="Joining the ACN network" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#relay-connections">
    Relay connections
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#delegate-connections">
    Delegate connections
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-transport">
    ACN transport
  </a>
<nav aria-label="ACN transport" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-envelope-entrance-agent-peer">
    ACN Envelope Entrance: Agent -&gt; Peer
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-envelope-routing">
    ACN Envelope Routing
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-envelope-exit-peer-agent">
    ACN Envelope Exit: Peer -&gt; Agent
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#connect-your-aea-to-the-acn">
    Connect your AEA to the ACN
  </a>
<nav aria-label="Connect your AEA to the ACN" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#the-valoryp2p_libp2p-connection">
    The valory/p2p_libp2p connection
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-valoryp2p_libp2p_client-connection">
    The valory/p2p_libp2p_client connection
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#known-issues-and-limitations">
    Known issues and limitations
  </a>
<nav aria-label="Known issues and limitations" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#delegate-client-on-client-disconnectionreconnection">
    Delegate client on client disconnection/reconnection
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#golang-node-python-client-libp2p-connection">
    Golang Node &lt;&gt; Python Client libp2p connection
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#what-a-peer-should-do-if-it-receives-an-acknowledgement-with-an-error">
    What a peer should do if it receives an acknowledgement with an error?
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#no-possibility-of-switching-peers">
    No possibility of switching peers
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_3" id="__nav_8_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_3">
          Developer Interfaces
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Developer Interfaces" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_8_3">
<span class="md-nav__icon md-icon"></span>
          Developer Interfaces
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_3_1" id="__nav_8_3_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_3_1">
          CLI
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="CLI" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_8_3_1">
<span class="md-nav__icon md-icon"></span>
          CLI
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../cli-how-to/">
        Installation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../cli-commands/">
        Commands
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../package-imports/">
        File structure
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../wealth/">
        Generating wealth
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_4" id="__nav_8_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_4">
          Benchmarks
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Benchmarks" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_8_4">
<span class="md-nav__icon md-icon"></span>
          Benchmarks
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../performance-benchmark/">
        Performance benchmark
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5" id="__nav_8_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5">
          API
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="API" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_8_5">
<span class="md-nav__icon md-icon"></span>
          API
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/abstract_agent/">
        AbstractAgent
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/aea/">
        AEA
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/aea_builder/">
        AEA Builder
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/agent/">
        Agent
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/agent_loop/">
        Agent Loop
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/common/">
        Common
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/exceptions/">
        Exceptions
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/launcher/">
        Launcher
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/multiplexer/">
        Multiplexer
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/runner/">
        Runner
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/runtime/">
        Runtime
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_12" id="__nav_8_5_12" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_12">
          Components
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Components" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_8_5_12">
<span class="md-nav__icon md-icon"></span>
          Components
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/components/base/">
        Base
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/components/loader/">
        Loader
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/components/utils/">
        Utils
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_13" id="__nav_8_5_13" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_13">
          Configurations
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Configurations" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_8_5_13">
<span class="md-nav__icon md-icon"></span>
          Configurations
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/configurations/base/">
        Base
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/configurations/constants/">
        Constants
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/configurations/data_types/">
        Data Types
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/configurations/loader/">
        Loader
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/configurations/manager/">
        Manager
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/configurations/pypi/">
        Pypi
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/configurations/utils/">
        Utils
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/configurations/validation/">
        Validation
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_14" id="__nav_8_5_14" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_14">
          Connections
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Connections" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_8_5_14">
<span class="md-nav__icon md-icon"></span>
          Connections
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/connections/base/">
        Base
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/context/base/">
        Context
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_16" id="__nav_8_5_16" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_16">
          Contracts
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Contracts" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_8_5_16">
<span class="md-nav__icon md-icon"></span>
          Contracts
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/contracts/base/">
        Base
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_17" id="__nav_8_5_17" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_17">
          Crypto
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Crypto" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_8_5_17">
<span class="md-nav__icon md-icon"></span>
          Crypto
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/crypto/base/">
        Base
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/crypto/helpers/">
        Helpers
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/crypto/ledger_apis/">
        LedgerApis
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/crypto/plugin/">
        Plugin
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/crypto/wallet/">
        Wallet
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_17_6" id="__nav_8_5_17_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_17_6">
          Registries
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Registries" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_8_5_17_6">
<span class="md-nav__icon md-icon"></span>
          Registries
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/crypto/registries/base/">
        Base
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_18" id="__nav_8_5_18" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_18">
          Decision Maker
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Decision Maker" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_8_5_18">
<span class="md-nav__icon md-icon"></span>
          Decision Maker
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/decision_maker/base/">
        Base
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/decision_maker/default/">
        Default
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_19" id="__nav_8_5_19" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_19">
          Error Handler
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Error Handler" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_8_5_19">
<span class="md-nav__icon md-icon"></span>
          Error Handler
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/error_handler/base/">
        Base
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/error_handler/default/">
        Default
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_20" id="__nav_8_5_20" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_20">
          Helpers
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Helpers" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_8_5_20">
<span class="md-nav__icon md-icon"></span>
          Helpers
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_20_1" id="__nav_8_5_20_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_20_1">
          ACN
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="ACN" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_8_5_20_1">
<span class="md-nav__icon md-icon"></span>
          ACN
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/acn/agent_record/">
        Agent Record
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/acn/uri/">
        URI
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/async_friendly_queue/">
        Async Friendly Queue
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/async_utils/">
        Async Utils
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/base/">
        Base
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/constants/">
        Constants
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/env_vars/">
        Env Vars
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/exception_policy/">
        Exception Policy
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/exec_timeout/">
        Exec Timeout
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/file_io/">
        File IO
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/file_lock/">
        File Lock
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/http_requests/">
        HttpRequests
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/install_dependency/">
        Install Dependency
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/io/">
        IO
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_20_14" id="__nav_8_5_20_14" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_20_14">
          IPFS
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="IPFS" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_8_5_20_14">
<span class="md-nav__icon md-icon"></span>
          IPFS
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/ipfs/base/">
        Base
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/ipfs/utils/">
        Utils
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/logging/">
        Logging
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_20_16" id="__nav_8_5_20_16" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_20_16">
          MultiAddress
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="MultiAddress" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_8_5_20_16">
<span class="md-nav__icon md-icon"></span>
          MultiAddress
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/multiaddr/base/">
        Base
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/multiple_executor/">
        MultipleExecutor
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/pipe/">
        Pipe
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_20_19" id="__nav_8_5_20_19" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_20_19">
          Preferences
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Preferences" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_8_5_20_19">
<span class="md-nav__icon md-icon"></span>
          Preferences
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/preference_representations/base/">
        Base
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/profiling/">
        Profiling
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_20_21" id="__nav_8_5_20_21" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_20_21">
          Search
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Search" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_8_5_20_21">
<span class="md-nav__icon md-icon"></span>
          Search
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/search/generic/">
        Generic
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/search/models/">
        Models
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/serializers/">
        Serializers
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_20_23" id="__nav_8_5_20_23" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_20_23">
          Storage
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Storage" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_8_5_20_23">
<span class="md-nav__icon md-icon"></span>
          Storage
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/storage/generic_storage/">
        GenericStorage
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_20_23_2" id="__nav_8_5_20_23_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_20_23_2">
          Backends
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Backends" class="md-nav" data-md-level="5">
<label class="md-nav__title" for="__nav_8_5_20_23_2">
<span class="md-nav__icon md-icon"></span>
          Backends
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/storage/backends/base/">
        Base
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/storage/backends/sqlite/">
        Sqlite
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/sym_link/">
        Sym Link
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_20_25" id="__nav_8_5_20_25" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_20_25">
          Transaction
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Transaction" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_8_5_20_25">
<span class="md-nav__icon md-icon"></span>
          Transaction
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/transaction/base/">
        Base
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/win32/">
        Win32
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/helpers/yaml_utils/">
        YamlUtils
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/identity/base/">
        Identity
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/mail/base/">
        Mail
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_23" id="__nav_8_5_23" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_23">
          Manager
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Manager" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_8_5_23">
<span class="md-nav__icon md-icon"></span>
          Manager
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/manager/manager/">
        Manager
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/manager/project/">
        Project
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/manager/utils/">
        Utils
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_24" id="__nav_8_5_24" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_24">
          Protocols
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Protocols" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_8_5_24">
<span class="md-nav__icon md-icon"></span>
          Protocols
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/protocols/base/">
        Base
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_24_2" id="__nav_8_5_24_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_24_2">
          Dialogue
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Dialogue" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_8_5_24_2">
<span class="md-nav__icon md-icon"></span>
          Dialogue
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/protocols/dialogue/base/">
        Base
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_24_3" id="__nav_8_5_24_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_24_3">
          Generator
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Generator" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_8_5_24_3">
<span class="md-nav__icon md-icon"></span>
          Generator
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/protocols/generator/base/">
        Base
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/protocols/generator/common/">
        Common
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/protocols/generator/extract_specification/">
        Extract Specification
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/protocols/generator/validate/">
        Validate
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_24_4" id="__nav_8_5_24_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_24_4">
          Signing Protocol
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Signing Protocol" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_8_5_24_4">
<span class="md-nav__icon md-icon"></span>
          Signing Protocol
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/protocols/signing/custom_types/">
        Custom Types
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/protocols/signing/dialogues/">
        Dialogues
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/protocols/signing/message/">
        Message
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/protocols/signing/serialization/">
        Serialization
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_25" id="__nav_8_5_25" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_25">
          Registries
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Registries" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_8_5_25">
<span class="md-nav__icon md-icon"></span>
          Registries
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/registries/base/">
        Base
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/registries/filter/">
        Filter
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/registries/resources/">
        Resources
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_26" id="__nav_8_5_26" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_26">
          Skills
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Skills" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_8_5_26">
<span class="md-nav__icon md-icon"></span>
          Skills
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/skills/base/">
        Base
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/skills/behaviours/">
        Behaviors
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/skills/tasks/">
        Task
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_27" id="__nav_8_5_27" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_27">
          Test Tools
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Test Tools" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_8_5_27">
<span class="md-nav__icon md-icon"></span>
          Test Tools
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/test_tools/constants/">
        Constants
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/test_tools/exceptions/">
        Exceptions
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/test_tools/generic/">
        Generic
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/test_tools/test_cases/">
        Test Cases
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/test_tools/test_contract/">
        Test Contract
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/test_tools/test_skill/">
        Test Skill
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_28" id="__nav_8_5_28" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_28">
          Plugins
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Plugins" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_8_5_28">
<span class="md-nav__icon md-icon"></span>
          Plugins
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_28_1" id="__nav_8_5_28_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_28_1">
          CLI
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="CLI" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_8_5_28_1">
<span class="md-nav__icon md-icon"></span>
          CLI
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_28_1_1" id="__nav_8_5_28_1_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_28_1_1">
          IPFS
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="IPFS" class="md-nav" data-md-level="5">
<label class="md-nav__title" for="__nav_8_5_28_1_1">
<span class="md-nav__icon md-icon"></span>
          IPFS
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/plugins/aea_cli_ipfs/core/">
        API
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/plugins/aea_cli_ipfs/registry/">
        Registry
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/plugins/aea_cli_ipfs/ipfs_utils/">
        Utils
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_28_2" id="__nav_8_5_28_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_28_2">
          Ledger
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Ledger" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_8_5_28_2">
<span class="md-nav__icon md-icon"></span>
          Ledger
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_28_2_1" id="__nav_8_5_28_2_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_28_2_1">
          Cosmos
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Cosmos" class="md-nav" data-md-level="5">
<label class="md-nav__title" for="__nav_8_5_28_2_1">
<span class="md-nav__icon md-icon"></span>
          Cosmos
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/plugins/aea_ledger_cosmos/cosmos/">
        API
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_28_2_2" id="__nav_8_5_28_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_28_2_2">
          Ethereum
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Ethereum" class="md-nav" data-md-level="5">
<label class="md-nav__title" for="__nav_8_5_28_2_2">
<span class="md-nav__icon md-icon"></span>
          Ethereum
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/plugins/aea_ledger_ethereum/ethereum/">
        API
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5_28_2_3" id="__nav_8_5_28_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_5_28_2_3">
          Fetchai
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Fetchai" class="md-nav" data-md-level="5">
<label class="md-nav__title" for="__nav_8_5_28_2_3">
<span class="md-nav__icon md-icon"></span>
          Fetchai
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api/plugins/aea_ledger_fetchai/fetchai/">
        API
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/plugins/aea_ledger_fetchai/_cosmos/">
        Helper
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../glossary/">
        Glossary
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../questions-and-answers/">
        Q&amp;A
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#messages-and-data-structures">
    Messages and Data Structures
  </a>
<nav aria-label="Messages and Data Structures" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#agent-record">
    Agent Record
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-message">
    ACN Message
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#status">
    Status
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#register">
    Register
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lookuprequest">
    LookupRequest
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lookupresponse">
    LookupResponse
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#aeaenvelope">
    AeaEnvelope
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-protocol-interactions">
    ACN Protocol Interactions
  </a>
<nav aria-label="ACN Protocol Interactions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#registration-interaction">
    "Registration" Interaction
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#look-up-interaction">
    "Look-up" Interaction
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#routing-interaction">
    "Routing" Interaction
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#joining-the-acn-network">
    Joining the ACN network
  </a>
<nav aria-label="Joining the ACN network" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#relay-connections">
    Relay connections
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#delegate-connections">
    Delegate connections
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-transport">
    ACN transport
  </a>
<nav aria-label="ACN transport" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-envelope-entrance-agent-peer">
    ACN Envelope Entrance: Agent -&gt; Peer
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-envelope-routing">
    ACN Envelope Routing
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#acn-envelope-exit-peer-agent">
    ACN Envelope Exit: Peer -&gt; Agent
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#connect-your-aea-to-the-acn">
    Connect your AEA to the ACN
  </a>
<nav aria-label="Connect your AEA to the ACN" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#the-valoryp2p_libp2p-connection">
    The valory/p2p_libp2p connection
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-valoryp2p_libp2p_client-connection">
    The valory/p2p_libp2p_client connection
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#known-issues-and-limitations">
    Known issues and limitations
  </a>
<nav aria-label="Known issues and limitations" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#delegate-client-on-client-disconnectionreconnection">
    Delegate client on client disconnection/reconnection
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#golang-node-python-client-libp2p-connection">
    Golang Node &lt;&gt; Python Client libp2p connection
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#what-a-peer-should-do-if-it-receives-an-acknowledgement-with-an-error">
    What a peer should do if it receives an acknowledgement with an error?
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#no-possibility-of-switching-peers">
    No possibility of switching peers
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/valory-xyz/open-aea/edit/master/docs/acn-internals.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"></path></svg>
</a>
<h1>ACN Internals</h1>
<p>The aim of this document is to describe at a high-level
the main implementation of the Agent Communication Network (ACN).</p>
<p>In particular:</p>
<ul>
<li>The <a href="https://github.com/valory-xyz/open-acn" target="_blank"><code>open-acn</code><a></a> Golang library; At the moment a copy resides locally in open-aea here as <code>libp2p_node</code>. </a></li>
<li>The <a href="https://github.com/valory-xyz/open-aea/tree/main/packages/valory/connections/p2p_libp2p" target="_blank"><code>valory/p2p_libp2p</code><a></a> AEA connection, written in Python, that implements the <em>direct connection</em> with an ACN peer;</a></li>
<li>The <a href="https://github.com/valory-xyz/open-aea/tree/main/packages/valory/connections/p2p_libp2p_client" target="_blank"><code>valory/p2p_libp2p_client</code><a></a> AEA connection, written in Python, which implements the <em>delegate connection</em> with an ACN peer.</a></li>
</ul>
<p>It is assumed the reader already knows what is the ACN and
its purposes; if not, we suggest reading <a href="../acn">this page<a></a>.</a></p>
<p>This documentation page is structured as follows:</p>
<ul>
<li>Firstly, the ACN protocol is described: all the messages
and data structures involved, as well as some example of interaction
protocol with these messages;</li>
<li>Then, it is explained how a peer can join an existing ACN network,
and the message exchange involved;</li>
<li>It follows the description of the journey of an envelope
  in the ACN network: from the agent connection to its contact
  peer, between ACN peers, and then from the contact peer of the
  destination agent to the target agent;</li>
<li>The following section describes the functionalities
  of the AEA connections that allow to communicate through
  the ACN: <code>valory/p2p_libp2p</code> and <code>valory/p2p_libp2p_client</code>;</li>
<li>The documentation ends with a section of known issues and limitations
  of the current implementation.</li>
</ul>
<h2 id="messages-and-data-structures">Messages and Data Structures</h2>
<p>At the foundation of the ACN there is the <em>ACN protocol</em>.
The protocol messages and the reply structure are generated from this 
<a href="https://github.com/valory-xyz/open-aea/blob/main/packages/open_aea/connections/p2p_libp2p/libp2p_node/protocols/acn/v1_0_0/acn.yaml" target="_blank">protocol specification</a>,
using the <a href="../protocol-generator" target="_blank">protocol generator</a>.
Therefore, it uses <a href="https://developers.google.com/protocol-buffers" target="_blank">Protocol Buffers</a>
as a serialization format, and the definition of the data structures involved is defined in this
<a href="https://github.com/valory-xyz/open-aea/blob/main/packages/open_aea/connections/p2p_libp2p/libp2p_node/protocols/acn/v1_0_0/acn.proto" target="_blank"><code>.proto</code> file</a>.</p>
<p>To know more about the protocol generator, refer to the relevant
section of the documentation:
<a href="../protocol-generator" target="_blank">Protocol Generator</a>.</p>
<h3 id="agent-record">Agent Record</h3>
<p>An <em>agent record</em> is a data structure containing information about an
agent and its Proof-of-Representation (PoR) to be used by a peer for other peers.
This data structure is used as a payload in other ACN messages (see below).</p>
<p>The <code>AgentRecord</code> data structure contains the following fields:</p>
<ul>
<li><code>service_id</code>: a string describing the service identifier.</li>
<li><code>ledger_id</code>: a string. It is the identifier of the ledger 
    this agent record is associated to.
    Currently, the allowed values are:<ul>
<li><code>fetchai</code>, the identifier for the Fetch.AI ledger;</li>
<li><code>ethereum</code>, the identifier for the Ethereum ledger;</li>
<li><code>cosmos</code>, the identifier for the Cosmos ledger;</li>
</ul>
</li>
<li><code>address</code>: a string. It is the public key of a public-private key pair.
    It is used as an identifier for routing purposes.</li>
<li><code>public_key</code>: a string. The representative's public key. Used in case of (PoR).</li>
<li><code>peer_public_key</code>: a string. The public key of the peer.</li>
<li><code>signature</code>: a string. The signature for PoR.</li>
<li><code>not_before</code>: a string. Specify the lower bound for certificate validity.
    If it is a string, it must follow the format: <code>YYYY-MM-DD</code>. It will be interpreted as time zone UTC-0</li>
<li><code>not_after</code>: a string. Specify the upper bound for certificate validity. 
    If it is a string, it must follow the format: <code>YYYY-MM-DD</code>. It will be interpreted as time zone UTC-0.</li>
</ul>
<h3 id="acn-message">ACN Message</h3>
<p>Entities in the ACN (i.e. either agents or peers) exchange <em>ACN messages</em>.
An ACN message contains a <code>payload</code> field,
which is the actual content of the message.</p>
<p>There are different types of payloads:</p>
<ul>
<li><code>Status</code></li>
<li><code>Register</code></li>
<li><code>LookupRequest</code></li>
<li><code>LookupResponse</code></li>
<li><code>AeaEnvelope</code></li>
</ul>
<h3 id="status">Status</h3>
<p>The <code>Status</code> payload is used as a response message to inform 
the sender about the handling of certain requests.
The payload contains:</p>
<ul>
<li>the <code>status_code</code>, a positive integer among the ones in the 
  <a href="https://github.com/valory-xyz/open-aea/blob/main/packages/open_aea/connections/p2p_libp2p/libp2p_node/protocols/acn/v1_0_0/acn.proto" target="_blank">Protobuf file</a>.</li>
<li>a list of error messages (string).</li>
</ul>
<p>A status code <code>0</code>, identified as <code>SUCCESS</code>, 
means that the request has been processed successfully.
Status codes greater than <code>0</code> can be:</p>
<ul>
<li>
<p>Generic errors: errors that occur under generic circumstances.</p>
<ul>
<li><code>ERROR_UNSUPPORTED_VERSION</code>, with integer value <code>1</code>: the receiver of the message
     does not support the protocol version of the sender;</li>
<li><code>ERROR_UNEXPECTED_PAYLOAD</code>, with integer value <code>2</code>: the payload could not be
     deserialised on the receiver side;</li>
<li><code>ERROR_GENERIC</code>, with integer value <code>3</code>: an internal error;</li>
<li><code>ERROR_SERIALIZATION</code>, with integer value <code>4</code>: a serialization error occurred
     on the receiving end;</li>
</ul>
</li>
<li>
<p>Register errors: errors that occur during agent registration operations in the ACN. </p>
<ul>
<li><code>ERROR_WRONG_AGENT_ADDRESS</code>, with integer value <code>10</code>:
     the PoR by a peer from another peer does not match the destination address of
     the envelope to be routed by the receiving peer.</li>
<li><code>ERROR_WRONG_PUBLIC_KEY</code>, with integer value <code>11</code>: the
     representative peer public key does not match the one in the agent record;</li>
<li><code>ERROR_INVALID_PROOF</code>, with integer value <code>12</code>: the signature is invalid;</li>
<li><code>ERROR_UNSUPPORTED_LEDGER</code>, with integer value <code>13</code>: the ledger of the PoR is not supported by the peer;</li>
</ul>
</li>
<li>
<p>Lookup and delivery errors: errors that occur during lookup to the DHT and envelope delivery operations in the ACN.</p>
<ul>
<li><code>ERROR_UNKNOWN_AGENT_ADDRESS</code>, with integer value <code>20</code>: the requested agent address has not been found in the local DHT of the peer;</li>
<li><code>ERROR_AGENT_NOT_READY</code>, with integer value <code>21</code>: the agent is not ready for envelope delivery.</li>
</ul>
</li>
</ul>
<h3 id="register">Register</h3>
<p>The <code>Register</code> payload is used to request a peer to register an agent among his known ones.
The payload contains the field <code>record</code>, which is an instance of <code>AgentRecord</code>.</p>
<h3 id="lookuprequest">LookupRequest</h3>
<p>The <code>LookupRequest</code> payload is sent between peer to look-up addresses in the Distributed Hash Table (DHT).
It contains the agent address (a string) that the sender needs to correctly route an envelope.</p>
<h3 id="lookupresponse">LookupResponse</h3>
<p>The <code>LookupResponse</code> payload is the response sent by a peer that received a <code>LookupRequest</code>.
It contains the <code>AgentRecord</code> associated to the requested address.</p>
<h3 id="aeaenvelope">AeaEnvelope</h3>
<p>The <code>AeaEnvelope</code> payload contains the envelope sent by an agent and to be delivered to another agent.
It contains:</p>
<ul>
<li><code>envelope</code>: the envelope to be forwarded, in byte representation;</li>
<li>an <code>AgentRecord</code> (see above).</li>
</ul>
<h2 id="acn-protocol-interactions">ACN Protocol Interactions</h2>
<p>The ACN protocol specifies three different possible interactions:</p>
<ul>
<li>the <em>registration</em> interaction</li>
<li>the <em>look-up</em> interaction</li>
<li>the <em>routing</em> interaction</li>
</ul>
<h3 id="registration-interaction">"Registration" Interaction</h3>
<p>The registration interaction is used by delegate agents or relayed peers
to register themselves to another peer.</p>
<div class="mermaid">
    sequenceDiagram
        participant Agent/RelayedPeer
        participant Peer
        Agent/RelayedPeer-&gt;&gt;Peer: Register(AgentRecord)
        alt success
            note over Peer: check PoR
            Peer-&gt;&gt;Agent/RelayedPeer: Status(SUCCESS)
        else wrong agent address
            Peer-&gt;&gt;Agent/RelayedPeer: Status(ERROR_WRONG_AGENT_ADDRESS)
        else wrong public key
            Peer-&gt;&gt;Agent/RelayedPeer: Status(ERROR_WRONG_PUBLIC_KEY)
        else invalid proof of representation
            Peer-&gt;&gt;Agent/RelayedPeer: Status(ERROR_INVALID_PROOF)
        else unsupported ledger
            Peer-&gt;&gt;Agent/RelayedPeer: Status(ERROR_UNSUPPORTED_LEDGER)
        end
</div>
<h3 id="look-up-interaction">"Look-up" Interaction</h3>
<p>The look-up interaction is used by a peer
to request information to another peer about an agent address.</p>
<div class="mermaid">
    sequenceDiagram
        participant Peer1
        participant Peer2
        Peer1-&gt;&gt;Peer2: LookupRequest(address)
        alt success
            Peer2-&gt;&gt;Peer1: LookupResponse(AgentRecord)
        else unknown agent address
            Peer2-&gt;&gt;Peer1: Status(ERROR_UNKNOWN_AGENT_ADDRESS)
        end
</div>
<h3 id="routing-interaction">"Routing" Interaction</h3>
<p>The routing interaction is used by agents
and peers to route the envelope through the ACN.</p>
<div class="mermaid">
    sequenceDiagram
        participant Peer1
        participant Peer2
        Peer1-&gt;&gt;Peer2: AeaEnvelope(envelope, AgentRecord)
        alt success
            note over Peer2: check PoR
            Peer2-&gt;&gt;Peer1: Status(SUCCESS)
        else error on decoding of Envelope payload
            Peer2-&gt;&gt;Peer1: Status(ERROR_SERIALIZATION)
        else PoR errors
            note over Peer1,Peer2: see above 
        end

</div>
<h2 id="joining-the-acn-network">Joining the ACN network</h2>
<p>When an ACN peer wants to join the network, it has
to start from a list of <em>bootstrap peers</em>, i.e.
a list of ACN peers to connect with (at least one).</p>
<p>Each node handles four different types of <a href="https://docs.libp2p.io/concepts/stream-multiplexing/" target="_blank">libp2p streams</a>:</p>
<ul>
<li>the <em>notification stream</em>, identified by the URI <code>/aea-notif/</code>:
  this stream is used by new peers to notify their existence to</li>
<li>the <em>address stream</em>, identified by the URI <code>/aea-address/</code>:
  used to send look-up requests and look-up responses;</li>
<li>the <em>envelope stream</em>, identified by the URI <code>/aea/</code>:
  used to forward and to receive ACN envelopes;</li>
<li>the <em>register relay stream</em>, identified by the URI <code>/aea-register/</code>:
  this is to receive messages from clients that want to register their agents addresses;
  this peer, and then it can register their addresses.</li>
</ul>
<p>To begin with, the node process initializes
the transport connections with the bootstrap peers,
the local copy of the Kademlia Distributed
Hash Table (DHT), 
the persistent storage for agent records,
and performs other non-functional operations 
like setting up the <a href="https://prometheus.io/" target="_blank"> Prometheus monitoring system</a>.
Optionally, can also start listening for relay connections
and delegate connections.</p>
<p>Then, it sets up the notification stream and notifies the bootstrap peers (if any).</p>
<div class="mermaid">
    sequenceDiagram
        participant Peer1
        participant Peer2
        participant Peer3
        note over Peer1: notify<br/>bootstrap peers
        Peer1-&gt;&gt;Peer2: notify
        Peer2-&gt;&gt;Peer2: wait until notifying peer <br/>added to DHT
        activate Peer2
        Peer1-&gt;&gt;Peer3: notify
        Peer3-&gt;&gt;Peer3: wait until notifying peer <br/>added to DHT
        activate Peer3
        note over Peer2,Peer3: Peer1 registered to DHT
        deactivate Peer2
        deactivate Peer3
        loop for each local/relay/delegate address 
            Peer1-&gt;&gt;Peer1: compute CID from address
            Peer1-&gt;&gt;Peer2: register address
            Peer1-&gt;&gt;Peer3: register address
        end
        note over Peer1: set up:<br/>- address stream<br/>- envelope stream<br/>- register relay stream
</div>
<h3 id="relay-connections">Relay connections</h3>
<p>If the ACN node is configured to run the relay service,
it sets up the register relay stream, waiting for registration
requests.</p>
<p>The following diagram shows an example of the message exchanged
during a registration request:</p>
<div class="mermaid">
    sequenceDiagram
        participant Agent
        participant Peer
        Agent-&gt;&gt;Peer: Register
        alt decoding error of ACN message
            Peer-&gt;&gt;Agent: Status(ERROR_SERIALIZATION)
        else wrong payload
            Peer-&gt;&gt;Agent: Status(ERROR_UNEXPECTED_PAYLOAD)
        else PoR check fails
            alt wrong agent address
                Peer-&gt;&gt;Agent: Status(ERROR_WRONG_AGENT_ADDRESS)
            else unsupported ledger
                Peer-&gt;&gt;Agent: Status(ERROR_UNSUPPORTED_LEDGER)
            else agent address and public key don't match
                Peer-&gt;&gt;Agent: Status(ERROR_WRONG_AGENT_ADDRESS)
            else invalid proof
                Peer-&gt;&gt;Agent: Status(ERROR_INVALID_PROOF)
            end
        else PoR check succeeds
            Peer-&gt;&gt;Agent: Status(SUCCESS)
            note over Peer: announce agent address<br/>to other peers
        end
</div>
<h3 id="delegate-connections">Delegate connections</h3>
<p>If the ACN node is configured to run the delegate service,
it starts listening from a TCP socket at a configurable URI.</p>
<p>To see a diagram of the message exchanged
during a registration request read 
<a href="../acn-internals#registration-interaction" target="_blank">this section</a>.</p>
<h2 id="acn-transport">ACN transport</h2>
<p>In the following sections, we describe the main three steps of the routing
of an envelope through the ACN:</p>
<ul>
<li><em>ACN entrance</em>: when an envelope sent by an agent enters 
  the peer-to-peer network via the peer the agent is connected to
  i.e. agent-to-peer communication;</li>
<li><em>ACN routing</em>: when an envelope gets routed through the peer-to-peer network,
  i.e. peer-to-peer communication;</li>
<li><em>ACN exit</em>: when an envelope gets delivered to the receiving agent
  through its representative peer, i.e. peer-to-agent communication.</li>
</ul>
<h3 id="acn-envelope-entrance-agent-peer">ACN Envelope Entrance: Agent -&gt; Peer</h3>
<p>In this section, we will describe the interaction protocols between agents and peers 
for the messages sent by the agent to the ACN network;
in particular, the communication from the contact peer of an agent to the agent.</p>
<p>The following diagram explains the exchange of messages on entering an envelope in the ACN.</p>
<p>In the case of <em>direct connection</em>, 
<code>Agent</code> is a Python process, whereas <code>Peer</code> is in a separate (Golang) process.
The logic of the Python Agent client is implemented in 
the <a href="https://github.com/valory-xyz/open-aea/tree/main/packages/valory/connections/p2p_libp2p" target="_blank"><code>valory/p2p_libp2p</code></a> connection.
The communication between <code>Agent</code> and <code>Peer</code> is done through 
an OS pipe for Inter-Process Communication (IPC) between the AEAs process and the libp2p node process;
then, the message gets enqueued to an output queue by an input coroutine.
Finally, the envelope ends up in an output queue, 
which is processed by an output coroutine and routed to the next peer.</p>
<p>In the case of <em>delegate connection</em>, 
the message exchange is very similar; however, instead of using 
pipes, the communication is done through the network, i.e. TCP,
with a peer which has the delegate service enabled.
The logic of the <code>Agent</code> client connected with a delegate connection
is implemented in the open-aea 
<a href="https://github.com/valory-xyz/open-aea/tree/main/packages/valory/connections/p2p_libp2p_client" target="_blank"><code>valory/p2p_libp2p_client</code></a> connection.</p>
<div class="mermaid">
    sequenceDiagram
        participant Agent
        participant Peer
        loop until Status(success) received
            Agent-&gt;&gt;Peer: AeaEnvelope
            Agent-&gt;&gt;Agent: wait
            note left of Agent: Wait until<br/>Status(success)
            alt successful case
                Peer-&gt;&gt;Agent: Status(success)
                note over Agent: break loop
            else ack-timeout OR conn-error
                note left of Agent: continue: Try to<br/>resend/reconnect
            else version not supported
                Peer-&gt;&gt;Agent: Status(ERROR_UNSUPPORTED_VERSION)
            else error on decoding of ACN message
                Peer-&gt;&gt;Agent: Status(ERROR_SERIALIZATION)
            else error on decoding of Envelope payload
                Peer-&gt;&gt;Agent: Status(ERROR_SERIALIZATION)
            else the payload cannot be handled
                Peer-&gt;&gt;Agent: Status(ERROR_UNEXPECTED_PAYLOAD)
            end
        end
        note over Peer: route envelope<br/>to next peer
</div>
<h3 id="acn-envelope-routing">ACN Envelope Routing</h3>
<p>In this section, we describe the interaction between peers
when it comes to envelope routing.</p>
<p>Assume an envelope arrives from an agent to peer <code>Peer1</code>,
i.e. <code>Peer1</code> is the first hop 
of the routing.
Let <code>Agent</code> be the local agent directly connected
to <code>Peer1</code>, <code>Peer2</code> a direct peer
of peer <code>Peer1</code>.</p>
<p>When the envelope is leaving <code>Peer1</code>,
we may have different scenario:</p>
<p>1) In case of direct connection,
   and the field <code>sender</code> of the envelope
   is not the local agent address: 
   the message is considered invalid, and it is dropped. </p>
<div class="mermaid">
    sequenceDiagram
        participant Agent
        participant Peer1
        participant Peer2
        Agent-&gt;&gt;Peer1: AeaEnvelope
        alt envelope sender not registered locally
            note over Peer1: stop, log error
        end
</div>
<p>2) the <code>target</code> of the envelope is 
   the local agent connected to the peer:
   the envelope is routed to the local agent.</p>
<div class="mermaid">
    sequenceDiagram
        participant Agent
        participant Peer1
        participant Peer2
        Agent-&gt;&gt;Peer1: AeaEnvelope
        alt target == peer1.my_agent
            note over Peer1: envelope designated<br/> to local agent,<br/> not routing
            loop agent not ready
                note over Peer1: sleep for 100ms
            end
            Peer1-&gt;&gt;Agent: AeaEnvelope
            Agent-&gt;&gt;Peer1: Status(Success)
        end
</div>
<p>3) the <code>target</code> is a delegate client.
   Send the envelope via TCP.</p>
<div class="mermaid">
    sequenceDiagram
        participant Delegate
        participant Peer1
        participant Peer2
        Delegate-&gt;&gt;Peer1: AeaEnvelope
        alt destination is a delegate
            note over Peer1: send envelope<br/> to delegate via TCP
            Peer1-&gt;&gt;Delegate: AeaEnvelope
            Delegate-&gt;&gt;Peer1: Status(Success)
        end
</div>
<p>4) Otherwise, look up the local DHT.
  If an entry is found, use it;
   otherwise, send a look-up request
   to connected peers.</p>
<div class="mermaid">
    sequenceDiagram
        participant Agent
        participant Peer1
        participant Peer2
        Agent-&gt;&gt;Peer1: AeaEnvelope
        alt address found in DHT
            note over Peer1: destination is a<br/>relay client
        else lookup address in DHT
            note over Peer1: send lookup request<br/> to all peers
            Peer1-&gt;&gt;Peer2: LookupRequest
            alt generic error
                Peer2-&gt;&gt;Peer1: Status(GENERIC_ERROR)
            else look-up response
                Peer2-&gt;&gt;Peer1: LookupResponse
                note over Peer1: Check PoR
            else not found
                Peer2-&gt;&gt;Peer1:Status(UNKNOWN_AGENT_ADDRESS)
            end
        end
        note over Peer1,Peer2: Now Peer1 knows the contact peer<br/>is PeerX
</div>
<p>In particular, when a peer receives a LookupRequest message,
it does the following:</p>
<div class="mermaid">
    sequenceDiagram
        participant Peer1
        participant Peer2
        Peer1-&gt;&gt;Peer2: LookupRequest
        alt error
            Peer2-&gt;&gt;Peer1: Status(Error)
        else local agent/relay/delegate
            note over Peer2: requested address is<br/>a local agent<br/>OR<br/>requested address is<br/>in my relay clients<br/>OR<br/>requested address is<br/>in my delegate clients
            Peer2-&gt;&gt;Peer1: LookupResponse
            note over Peer1: Check PoR
        else not found locally
            note over Peer2: send lookup request<br/>to other peers...
            alt found
                Peer2-&gt;&gt;Peer1: LookupResponse
                note over Peer1: Check PoR
            else not found
                Peer2-&gt;&gt;Peer1:Status(UNKNOWN_AGENT_ADDRESS)
            end
        end
</div>
<p>Let <code>Peer3</code> the contact peer of the recipient of the envelope. 
The following diagram shows how the contact peer of the 
envelope recipient handles the incoming envelope:</p>
<div class="mermaid">
    sequenceDiagram
        participant Peer1
        participant Peer3
        Peer1-&gt;&gt;Peer3: AeaEnvelope
        alt decoding error of ACN message
            Peer3-&gt;&gt;Peer1: Status(ERROR_SERIALIZATION)
        else unexpected payload
            Peer3-&gt;&gt;Peer1: Status(ERROR_UNEXPECTED_PAYLOAD)
        else decoding error of envelope payload
            Peer3-&gt;&gt;Peer1: Status(ERROR_SERIALIZATION)        
        else PoR check fails
            alt wrong agent address
                Peer3-&gt;&gt;Peer1: Status(ERROR_WRONG_AGENT_ADDRESS)
            else unsupported ledger
                Peer3-&gt;&gt;Peer1: Status(ERROR_UNSUPPORTED_LEDGER)
            else agent address and public key don't match
                Peer3-&gt;&gt;Peer1: Status(ERROR_WRONG_AGENT_ADDRESS)
            else invalid proof
                Peer3-&gt;&gt;Peer1: Status(ERROR_INVALID_PROOF)
            end
        else PoR check succeeds
            alt target is delegate, not ready
                Peer3-&gt;&gt;Peer1: Status(ERROR_AGENT_NOT_READY)
            else exists delegate, ready
                note over Peer3: forward envelope via<br/>delegate connection
                Peer3-&gt;&gt;Peer1: Status(SUCCESS)
            else target is local agent, not ready
                Peer3-&gt;&gt;Peer1: Status(ERROR_AGENT_NOT_READY)
            else target is local agent, ready
                note over Peer3: forward envelope via<br/>direct connection
                Peer3-&gt;&gt;Peer1: Status(SUCCESS)
            else agent does not exist
                Peer3-&gt;&gt;Peer1: Status(ERROR_UNKNOWN_AGENT_ADDRESS)
            end
        end
</div>
<h3 id="acn-envelope-exit-peer-agent">ACN Envelope Exit: Peer -&gt; Agent</h3>
<p>The following diagram explains the exchange of messages on exiting an envelope in the ACN.
That is, the communication from the contact peer of an agent to the agent.</p>
<p>The same message exchange is done 
both in the case of direct connection and
delegate connection,
similarly for what has been described for the envelope entrance
<a href="../acn-internals#acn-envelope-entrance-agent-peer">(see above)</a>.</p>
<div class="mermaid">
    sequenceDiagram
        participant Agent
        participant Peer
        Peer-&gt;&gt;Agent: AeaEnvelope
        alt successful case
            Agent-&gt;&gt;Peer: Status(success)
        else ack-timeout OR conn-error
            note left of Peer: do nothing
        else error on decoding of ACN message
            Agent-&gt;&gt;Peer: Status(GENERIC_ERROR)
        else error on decoding of Envelope payload
            Agent-&gt;&gt;Peer: Status(GENERIC_ERROR)
        else wrong payload
            Agent-&gt;&gt;Peer: Status(GENERIC_ERROR)
        end
</div>
<h2 id="connect-your-aea-to-the-acn">Connect your AEA to the ACN</h2>
<p>To connect the AEA to the ACN network,
there are two AEA connections available:</p>
<ul>
<li>the <code>valory/p2p_libp2p</code>, that implements
  a direct connection, and</li>
<li>the <code>valory/p2p_libp2p_client</code> connection,
  that implements the delegate connection.</li>
</ul>
<p>For more information on the AEA connection package type,
refer to <a href="../connection/" target="_blank">this guide</a>.</p>
<h3 id="the-valoryp2p_libp2p-connection">The <code>valory/p2p_libp2p</code> connection</h3>
<p>The source code of the <code>valory/p2p_libp2p</code> connection can be downloaded
<a href="https://github.com/valory-xyz/open-aea/tree/main/packages/valory/connections/p2p_libp2p" target="_blank">here</a>.</p>
<p>The package provides the connection class <code>P2PLibp2pConnection</code>,
which implements the <code>Connection</code> interface and
therefore can be used by the Multiplexer as any other connection.</p>
<ul>
<li>The <code>connect</code> method of this connection spawns a new instance
  of the <a href="https://github.com/valory-xyz/open-aea/blob/main/packages/valory/connections/p2p_libp2p/libp2p_node/libp2p_node.go" target="_blank"><code>libp2p_node</code> program</a>
(i.e. an ACN peer node) and connects to it through OS pipes. 
Then, it sets up the <em>message receiving loop</em>,
  which enqueues messages in the input queue to be read by <code>read</code> method calls,
  and the <em>message sending loop</em>, 
  which dequeues messages from the output queue and forwards them to the Libp2p node. 
The loops are run concurrently in the Multiplexer thread, 
  using the Python asynchronous programming library <code>asyncio</code>.  </li>
</ul>
<div class="mermaid">
    sequenceDiagram
        participant Libp2p Connection
        participant sending loop
        participant receiving loop
        participant Libp2p Node
        Libp2p Connection-&gt;&gt;Libp2p Node: spawn process
        activate Libp2p Node
        Libp2p Connection-&gt;&gt;sending loop: start recv loop
        sending loop-&gt;&gt;sending loop: wait messages from output queue
        activate sending loop
        Libp2p Connection-&gt;&gt;receiving loop: start send loop
        receiving loop-&gt;&gt;receiving loop: wait messages from input queue
        activate receiving loop
        deactivate Libp2p Node
        deactivate sending loop
        deactivate receiving loop
</div>
<ul>
<li>The <code>send</code> method enqueues a message in the output queue.
The message is then dequeued by the sending loop,
and then sent to the Libp2p node. </li>
</ul>
<div class="mermaid">
    sequenceDiagram
        participant Libp2p Connection
        participant sending loop
        participant Libp2p Node
        activate sending loop
        Libp2p Connection-&gt;&gt;Libp2p Connection: enqueue message to output queue
        sending loop-&gt;&gt;sending loop: dequeue message from output queue
        deactivate sending loop
        sending loop-&gt;&gt;Libp2p Node: AeaEnvelope
        sending loop-&gt;&gt;sending loop: wait for status
        activate sending loop
        alt success
            note over Libp2p Node: route envelope
            Libp2p Node-&gt;&gt;sending loop: Status(SUCCESS)
            deactivate sending loop
            note over sending loop: OK
        else timed out
            note over sending loop: raise with error
        else acn message decoding error 
            Libp2p Node-&gt;&gt;sending loop: Status(ERROR_SERIALIZATION)
        else unexpected payload
            Libp2p Node-&gt;&gt;sending loop: Status(ERROR_UNEXPECTED_PAYLOAD)
        else envelope decoding error 
            Libp2p Node-&gt;&gt;sending loop: Status(ERROR_SERIALIZATION)
        end
</div>
<ul>
<li>The <code>receive</code> method dequeues a message from the input queue.
The queue is populated by the receiving loop,
which receives messages from the Libp2p node. </li>
</ul>
<div class="mermaid">
    sequenceDiagram
        participant Libp2p Connection
        participant receiving loop
        participant Libp2p Node
        activate receiving loop
        Libp2p Node-&gt;&gt;receiving loop: AeaEnvelope
        deactivate receiving loop
        Libp2p Node-&gt;&gt;Libp2p Node: wait for status
        activate Libp2p Node
        alt success
            note over receiving loop: enqueue envelope<br/>to input queue
            receiving loop-&gt;&gt;Libp2p Node: Status(SUCCESS)
            deactivate Libp2p Node
            note over receiving loop: OK
        else timed out
            note over Libp2p Node: ignore
        else acn message decoding error 
            receiving loop-&gt;&gt;Libp2p Node: Status(ERROR_SERIALIZATION)
        else unexpected payload
            receiving loop-&gt;&gt;Libp2p Node: Status(ERROR_UNEXPECTED_PAYLOAD)
        else envelope decoding error 
            receiving loop-&gt;&gt;Libp2p Node: Status(ERROR_SERIALIZATION)
        end
        Libp2p Connection-&gt;&gt;receiving loop: read message from output queue
        note over Libp2p Connection: return message<br/>to Multiplexer
</div>
<ul>
<li>the <code>disconnect</code> method stops both the receiving loop and the sending loop,
  and stops the Libp2p node.</li>
</ul>
<h3 id="the-valoryp2p_libp2p_client-connection">The <code>valory/p2p_libp2p_client</code> connection</h3>
<p>The source code of the <code>valory/p2p_libp2p_client</code> connection can be downloaded
<a href="https://github.com/valory-xyz/open-aea/tree/main/packages/valory/connections/p2p_libp2p_client" target="_blank">here</a>.</p>
<p>The package provides the connection class <code>P2PLibp2pClientConnection</code>,
which implements the <code>Connection</code> interface and
therefore can be used by the Multiplexer as any other connection.</p>
<ul>
<li>The <code>connect</code> method of this connection will set up a TCP
  connection to the URI of the delegate peer. Then, it will
  send a <code>Register</code> request to register the agent among the peer's
  client connections.
  On registration success, it sets up the <em>message receiving loop</em>, 
  which enqueues messages in the input queue to be read by read method calls, 
  and the <em>message sending loop</em>, which dequeues messages from the output queue 
  and forwards them to the Libp2p node. 
  The loops are run concurrently in the Multiplexer thread, 
  using the Python asynchronous programming library <code>asyncio</code>.</li>
</ul>
<div class="mermaid">
    sequenceDiagram
        participant Libp2p Client Connection
        participant Libp2p Node
        activate Libp2p Node
        Libp2p Node-&gt;&gt;Libp2p Node: listening for TCP connections
        Libp2p Client Connection-&gt;&gt;Libp2p Node: Register (via TCP)
        deactivate Libp2p Node
        alt decoding error of ACN message
            Libp2p Node-&gt;&gt;Libp2p Client Connection: Status(ERROR_SERIALIZATION)
        else wrong payload
            Libp2p Node-&gt;&gt;Libp2p Client Connection: Status(ERROR_UNEXPECTED_PAYLOAD)
        else PoR check fails
            alt wrong agent address
                Libp2p Node-&gt;&gt;Libp2p Client Connection: Status(ERROR_WRONG_AGENT_ADDRESS)
            else unsupported ledger
                Libp2p Node-&gt;&gt;Libp2p Client Connection: Status(ERROR_UNSUPPORTED_LEDGER)
            else agent address and public key don't match
                Libp2p Node-&gt;&gt;Libp2p Client Connection: Status(ERROR_WRONG_AGENT_ADDRESS)
            else invalid proof
                Libp2p Node-&gt;&gt;Libp2p Client Connection: Status(ERROR_INVALID_PROOF)
            end
        else PoR check succeeds
            Libp2p Node-&gt;&gt;Libp2p Client Connection: Status(SUCCESS)
            note over Libp2p Node: announce agent<br/>address to<br/>other peers
            Libp2p Node-&gt;&gt;Libp2p Node: wait data from socket 
            activate Libp2p Node
            deactivate Libp2p Node
        end
</div>
<ul>
<li>
<p>The <code>send</code> method and the <code>receive</code> methods behave similarly to
  the <code>send</code> and <code>receive</code> methods of the <code>valory/p2p_libp2p</code> connection,
  in terms of message exchange;
  however, the communication is done via TCP rather than pipes.</p>
</li>
<li>
<p>The <code>disconnect</code> method interrupts the connection with the delegate peer,
  without explicitly unregistering.</p>
</li>
</ul>
<h2 id="known-issues-and-limitations">Known issues and limitations</h2>
<p>In this section, we provide a list of known issues
and limitations of the current implementation
of the ACN, considering both the ACN nodes (written in Golang)
and the AEA connections, for the Python AEA framework, to interact with them.</p>
<h3 id="delegate-client-on-client-disconnectionreconnection">Delegate client on client disconnection/reconnection</h3>
<p>In case of disconnection/reconnection, delegate client record will be removed.
This can cause two problems: either the delegate client is not found, 
or connection is closed during the send operation.</p>
<p>Possible solutions:</p>
<ul>
<li>Create more complicated structure for clients storage;</li>
<li>Keep the delegate client record for longer; </li>
<li>Clean up the record by timeout, per client queues.</li>
</ul>
<p>Code references:</p>
<ul>
<li><a href="https://github.com/valory-xyz/open-aea/blob/5e35f68adeda724d403349f3ce52b895e3c64631/packages/valory/connections/p2p_libp2p/libp2p_node/dht/dhtpeer/dhtpeer.go#L994" target="_blank">agent record removal</a></li>
<li><a href="https://github.com/valory-xyz/open-aea/blob/5e35f68adeda724d403349f3ce52b895e3c64631/packages/valory/connections/p2p_libp2p/libp2p_node/dht/dhtpeer/dhtpeer.go#L1110" target="_blank">message routing</a></li>
</ul>
<h3 id="golang-node-python-client-libp2p-connection">Golang Node &lt;&gt; Python Client <code>libp2p</code> connection</h3>
<p>In case of connection between the Golang side (i.e. ACN node) 
and the Python side (i.e. the <code>libp2p</code> AEA connection) is broken, 
there is no reconnection attempt.
The Golang side connect to the Python server opened, 
but if the connection is broken Golang can try to reconnect; 
however, the Python side does not know about this and will restart
the node completely.</p>
<p>Possible solutions: the problem requires updates on both sides and assume possible timeouts on broken connection.
If connection is broken, the Python side awaits for reconnection from Golang side, 
and restart node completely after timeout.</p>
<h3 id="what-a-peer-should-do-if-it-receives-an-acknowledgement-with-an-error">What a peer should do if it receives an acknowledgement with an error?</h3>
<p>If an ACN response is the <code>Status</code> with error code different from <code>SUCCESS</code>,
the forwarding to other peers is not repeated. </p>
<p>A possible solution is to resend the message; however,
not clear why it should help in case of healthy connection,
how many times the sender should retry, and how it would help.</p>
<p>Discussion on GitHub: 
<a href="https://github.com/fetchai/agents-aea/pull/2509#discussion_r642628983" target="_blank">https://github.com/fetchai/agents-aea/pull/2509#discussion_r642628983</a></p>
<h3 id="no-possibility-of-switching-peers">No possibility of switching peers</h3>
<p>In case of a peer becoming unavailable, a delegate client or relay client currently has no means to automatically switch the peer. In particular, the DHT should be updated when a client switches peers.</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: ACN Connections" class="md-footer__link md-footer__link--prev" href="../p2p-connection/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Previous
              </span>
              ACN Connections
            </div>
</div>
</a>
<a aria-label="Next: Installation" class="md-footer__link md-footer__link--next" href="../cli-how-to/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Next
              </span>
              Installation
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.5e67fbfe.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
<script src="../assets/javascripts/bundle.c44cc438.min.js"></script>
<script src="https://unpkg.com/mermaid@8.10.1/dist/mermaid.min.js"></script>
</body>
</html>